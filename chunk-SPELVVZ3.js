import{a as N,b as W,c as q,d as G}from"./chunk-NBTRWLNO.js";import{b as A,c as R}from"./chunk-P3ALKQJN.js";import{a as z,b as H}from"./chunk-ZSOYSSWO.js";import{d as D}from"./chunk-3MCZF45O.js";import{j as B}from"./chunk-DTS6JUDK.js";import{Ab as d,Bb as i,Cb as r,Db as v,Jb as c,Kb as E,Pa as S,Sa as o,Vb as f,Wb as g,Xb as m,Yb as a,Zb as L,cc as F,db as O,dc as u,hb as T,ra as C,ua as P,wb as x,yb as k,zb as I}from"./chunk-TEXVEQLC.js";import{h as y,i as w}from"./chunk-5KHZBZE7.js";function J(l,t){if(l&1&&(i(0,"span",11),a(1),r()),l&2){let n=t.$implicit,e=E();g("visible",e.showIcon()[n.class]),o(),L(n.value)}}var j=class l extends q{cues=[];showIcon=C(Object.fromEntries(this.cues.map(t=>[t.class,!1])));fullWindowLink="/experiments/motor-imagery/wordcued/stimuli";normalWindowLink="/experiments/motor-imagery/wordcued";startCountdownValue=5;ngOnInit(){return w(this,null,function*(){y(l.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Word-Cued Motor Imagery" CYAN 3;'),this.cues=this.experimentConfig.classes.map(t=>({class:t,value:t}))})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let t=[];for(let n of this.experimentConfig.classes)for(let e=0;e<this.experimentConfig.trials_per_class;e++)t.push({class:n,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return t=this.shuffle(t),t}showTrial(t){this.showIcon.set(Object.fromEntries(this.cues.map(n=>[n.class,n.class===t])))}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let t=this.generateTrials(),n=performance.now(),e=0,s=[],h=()=>{s.forEach(p=>window.clearTimeout(p)),s=[]},_=()=>{if(e>=t.length){h(),this.onDelivery.set(!1);return}let p=t[e],V=n+t.slice(0,e).reduce((b,M)=>b+M.duration+M.soa,0),$=Math.max(0,V-performance.now()),Y=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "${p.class}" GREEN;`),this.showTrial(p.class);let b=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),e++,this.setProgress(100*e/t.length),_()},p.duration);s.push(b)},$);s.push(Y)};return _(),h}static \u0275fac=(()=>{let t;return function(e){return(t||(t=P(l)))(e||l)}})();static \u0275cmp=O({type:l,selectors:[["app-stimuli"]],features:[T],decls:26,vars:27,consts:[["matIconButton","","matTooltip","\u26A0\uFE0F Stop stimulus delivery",1,"stop","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Starting will begin stimulus delivery",1,"start","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Fullscreen will restart stimulus delivery",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Exiting fullscreen will restart stimulus delivery",3,"routerLink"],["matIconButton","","id","mode-light",3,"click"],["matIconButton","","id","mode-dark",3,"click"],[1,"bottom-left"],[1,"center","counter",3,"innerHTML"],[1,"center","fixation"],[1,"center","cue","conditional-visible",3,"visible"],["mode","determinate",3,"value"],[1,"center","cue","conditional-visible"]],template:function(n,e){n&1&&(i(0,"div")(1,"button",0),c("click",function(){return e.stopSequence()}),i(2,"mat-icon"),a(3,"stop_circle"),r()(),i(4,"button",1),c("click",function(){return e.startCountdown()}),i(5,"mat-icon"),a(6,"play_circle"),r()(),i(7,"button",2),c("click",function(){return e.gotoFullWindow()}),i(8,"mat-icon"),a(9,"arrows_output"),r()(),i(10,"button",3)(11,"mat-icon"),a(12,"fullscreen_exit"),r()(),i(13,"button",4),c("click",function(){return e.setReactiveMode("light")}),i(14,"mat-icon"),a(15,"light_mode"),r()(),i(16,"button",5),c("click",function(){return e.setReactiveMode("dark")}),i(17,"mat-icon"),a(18,"dark_mode"),r()(),v(19,"app-hardware",6)(20,"span",7),i(21,"mat-icon",8),a(22,"point_scan"),r(),k(23,J,2,3,"span",9,x),v(25,"mat-progress-bar",10),r()),n&2&&(m(u("screen ",e.embeded)),o(),g("visible-b",e.onDelivery()),o(3),g("visible-b",!e.onDelivery()),o(3),m(u("bottom-right fullscreen ",e.embeded)),o(3),m(u("bottom-right appscreen ",e.embeded)),d("routerLink",F(e.normalWindowLink)),o(3),m(u("top-right mode-button ",e.embeded)),f("display",e.currentMode==="dark"?"flex":"none"),o(3),m(u("top-right mode-button ",e.embeded)),f("display",e.currentMode==="dark"?"none":"flex"),o(4),d("innerHTML",e.countdownTimer(),S),o(3),I(e.cues),o(2),d("value",e.progressValue()))},dependencies:[R,A,B,W,N,D,G,H,z],styles:[".start[_ngcontent-%COMP%], .stop[_ngcontent-%COMP%]{scale:2}.conditional-visible-b.visible-b[_ngcontent-%COMP%]{visibility:visible}.conditional-visible-b[_ngcontent-%COMP%]{visibility:hidden}.screen[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-surface);width:100vw;height:100vh;position:relative;box-sizing:border-box;overflow:hidden}.screen.embeded[_ngcontent-%COMP%]{border-radius:var(--mat-sys-corner-large);width:100%;height:50vh;margin:0 auto}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.counter[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);font:var(--mat-sys-body-small);font-size:12vh}.fixation[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);z-index:9999}.bottom-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;bottom:16px}.bottom-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;bottom:16px}.top-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;top:16px}.top-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;top:16px}button.top-left[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], button.bottom-right[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:1em;height:1em}.stop[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.fullscreen[_ngcontent-%COMP%]{display:none}.appscreen[_ngcontent-%COMP%], .fullscreen.embeded[_ngcontent-%COMP%]{display:block}.appscreen.embeded[_ngcontent-%COMP%]{display:none}.mode-button.embeded[_ngcontent-%COMP%]{display:none!important}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}button[_ngcontent-%COMP%]{z-index:1000}",'.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-size:200px;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto}']})};export{j as a};
