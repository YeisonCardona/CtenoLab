import{c as P}from"./chunk-4PHGQJCB.js";import{a as E,b as L,c as O,d as B}from"./chunk-PMQPYQZU.js";import{k as F}from"./chunk-FNTTNCNS.js";import{c as I}from"./chunk-XRGWM46W.js";import{b as k}from"./chunk-EBVX5MXQ.js";import{$b as S,Ab as _,Bb as l,Cb as c,Mb as M,Sa as o,Yb as T,_b as w,db as d,hb as v,ra as g,tb as y,ua as h,wb as C,yb as b,zb as x}from"./chunk-JNWBK6C6.js";import{i as p,j as u,k as f}from"./chunk-GV7GV3NK.js";function j(m,e){if(m&1&&(l(0,"span",3,0),w(2),c()),m&2){let i=e.$implicit,t=M();T("visible",t.showIcon()[i.class]),y("cue-key",t.fixClass(i.class)),o(2),S(i.value)}}var a=class a extends O{showIcon=g(Object.fromEntries(this.cues().map(e=>[e.class,!1])));fullWindowLink="/paradigms/p300/rsvp-speller/stimuli";normalWindowLink="/paradigms/p300/rsvp-speller";startCountdownValue=5;ngOnInit(){return f(this,null,function*(){u(a.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "RSVP Speller" BLUE 3;')})}generateCues(){this.cues.set(Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]})))}generateTrials(){let e=[];for(let i=0;i<this.experimentConfig.target_characters;i++){let t=this.shuffle(this.cues().map(r=>r.class)),s=t[0];t=t.slice(1),e.push({class:s+"-Feedback",duration:this.experimentConfig.target_duration,soa:this.experimentConfig.soa_inter_trial});let n=[],R=Math.floor(this.experimentConfig.target_probability*this.experimentConfig.repetitions_per_target/100);for(let r=0;r<R;r++)n.push({class:s+"-Target",duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial});for(let r=n.length;r<this.experimentConfig.repetitions_per_target;r++)n.push({class:this.getRandomItems(t,1)+"-NonTarget",duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial});n=this.shufflePreservingParity(n),n[n.length-1].soa=this.experimentConfig.soa_intra_trial,e.push(...n)}return e.flat()}showTrial(e){if(console.log(e),e===null){this.showIcon.set(Object.fromEntries(this.cues().map(s=>[s.class,s.class===e])));return}e.includes("-")||(e=e+"-Feedback");let[i,t]=e.split("-");if(this.propagateClassMarker(t.trim()),t==="Feedback"){let s=this.cuesSpanElement.find(n=>n.nativeElement.getAttribute("cue-key")===this.fixClass(i));s&&(s.nativeElement.style.color="var(--mat-sys-error)",setTimeout(()=>{s.nativeElement.style.color="var(--mat-sys-primary)"},this.experimentConfig.target_duration+50))}this.showIcon.set(Object.fromEntries(this.cues().map(s=>[s.class,s.class===i])))}stopStimuliSequence(){this.showTrial(null)}static \u0275fac=(()=>{let e;return function(t){return(e||(e=h(a)))(t||a)}})();static \u0275cmp=d({type:a,selectors:[["app-stimuli"]],features:[v],decls:3,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(l(0,"app-stimuli-layout",1),b(1,j,3,4,"span",2,C),c()),i&2&&(_("hostRef",t),o(),x(t.cues()))},dependencies:[I,E,k,P,F,B],styles:['.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-size:10vh;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .1s ease,visibility .1s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}']})};p([L("TRIAL",{arguments:["CLASS"],example:"Trial Target",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],a.prototype,"showTrial",1);var D=a;export{D as a};
