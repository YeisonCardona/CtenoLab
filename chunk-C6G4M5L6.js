import{a as A,b as u,c as D,d as k}from"./chunk-EVPFZQXT.js";import{c as P}from"./chunk-62AV6QVL.js";import{b as _}from"./chunk-7J34S6W5.js";import{$b as R,Ab as M,Bb as c,Cb as m,Mb as E,Sa as l,Yb as O,_b as L,db as C,hb as T,ra as y,tb as b,ua as w,wb as x,yb as S,zb as I}from"./chunk-P6GYV7WW.js";import{h as o,i as g,j as v}from"./chunk-HVQDNULJ.js";function j(p,e){if(p&1&&(c(0,"span",3,0),L(2),m()),p&2){let i=e.$implicit,t=E();O("visible",t.showIcon()[i.class]),b("cue-key",t.fixClass(i.class)),l(2),R(i.value)}}var s=class s extends D{cues=[];showIcon=y(Object.fromEntries(this.cues.map(e=>[e.class,!1])));fullWindowLink="/paradigms/motor-imagery/wordcued/stimuli";normalWindowLink="/paradigms/motor-imagery/wordcued";startCountdownValue=5;ngOnInit(){return v(this,null,function*(){g(s.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Word-Cued Motor Imagery" BLUE 3;'),this.cues=Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]}))})}generateTrials(){let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.showIcon.set(Object.fromEntries(this.cues.map(i=>[i.class,i.class===e])))}setOpacity(e,i){let t=this.cuesElement.find(n=>n._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(e));t&&(t._elementRef.nativeElement.style.opacity=i.toString())}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,n=[],d=()=>{n.forEach(a=>window.clearTimeout(a)),n=[]},h=()=>{if(t>=e.length){d(),this.onDelivery.set(!1);return}let a=e[t],F=i+e.slice(0,t).reduce((r,f)=>r+f.duration+f.soa,0),G=Math.max(0,F-performance.now()),N=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial Start: ${a.class}" GREEN;`),this.showTrial(a.class);let r=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial End: ${a.class}" ORANGE;`),this.showTrial(null),t++,this.setProgress(100*t/e.length),h()},a.duration);n.push(r)},G);n.push(N)};return h(),d}static \u0275fac=(()=>{let e;return function(t){return(e||(e=w(s)))(t||s)}})();static \u0275cmp=C({type:s,selectors:[["app-stimuli"]],features:[T],decls:3,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(c(0,"app-stimuli-layout",1),S(1,j,3,4,"span",2,x),m()),i&2&&(M("hostRef",t),l(),I(t.cues))},dependencies:[P,A,_,k],styles:['.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-size:10vh;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}']})};o([u("TRIAL",{arguments:["CLASS"],example:"Trial Right",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],s.prototype,"showTrial",1),o([u("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Right 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],s.prototype,"setOpacity",1);var B=s;export{B as a};
