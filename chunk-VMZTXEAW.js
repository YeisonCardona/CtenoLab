import{a as H,b as W,c as j,d as G}from"./chunk-O45ZBGGD.js";import{b as q,c as R}from"./chunk-P3ALKQJN.js";import{a as z,b as N}from"./chunk-ZSOYSSWO.js";import{d as B}from"./chunk-3MCZF45O.js";import{j as A}from"./chunk-DTS6JUDK.js";import{Ab as h,Bb as o,Cb as s,Db as C,Jb as m,Kb as y,Pa as E,Sa as r,Vb as S,Wb as g,Xb as u,Yb as l,Zb as T,cc as D,db as L,dc as p,hb as F,ra as f,ua as k,wb as _,yb as M,zb as w}from"./chunk-TEXVEQLC.js";import{h as x,i as I}from"./chunk-5KHZBZE7.js";function U(a,e){if(a&1&&(o(0,"span",12),l(1),s()),a&2){let i=e.$implicit,t=y();g("intentional",t.showIcon()[i.class]),r(),T(i.value)}}function X(a,e){if(a&1&&(o(0,"span",12),l(1),s()),a&2){let i=e.$implicit,t=y();g("visible",t.showIntentionalIcon()[i.class]),r(),T(i.value)}}var $=class a extends j{cues=[];intentionalCues=[];showIcon=f(Object.fromEntries(this.cues.map(e=>[e.class,!1])));showIntentionalIcon=f(Object.fromEntries(this.intentionalCues.map(e=>[e.class,!1])));fullWindowLink="/experiments/motor-imagery/sequential/stimuli";normalWindowLink="/experiments/motor-imagery/sequential";startCountdownValue=5;ngOnInit(){return I(this,null,function*(){x(a.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Sequential Motor Imagery" CYAN 3;')})}generateTrials(){this.cues=this.experimentConfig.classes.map(i=>{let t=i.split("->").map(n=>n.trim());return{class:t[0],value:t[0]}}),this.intentionalCues=this.experimentConfig.classes.map(i=>{let t=i.split("->").map(n=>n.trim());return{class:t[1],value:t[1]}}),this.hardwareService.writeLine("CMD=@CLA;");let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){let i;e!==null?i=e.split("->").map(n=>n.trim())[0]:i=null,this.showIcon.set(Object.fromEntries(this.cues.map(t=>[t.class,t.class===i])))}showIntentionalTrial(e){let i;e!==null?i=e.split("->").map(n=>n.trim())[1]:i=null,this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(t=>[t.class,t.class===i])))}stopStimuliSequence(){this.showTrial(null),this.showIntentionalTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,n=[],O=()=>{n.forEach(c=>window.clearTimeout(c)),n=[]},P=()=>{if(t>=e.length){O(),this.onDelivery.set(!1);return}let c=e[t],V=i+e.slice(0,t).reduce((v,d)=>v+d.duration+d.duration+d.soa,0),Y=Math.max(0,V-performance.now()),J=window.setTimeout(()=>{let v=c.class.split("->").map(b=>b.trim());this.hardwareService.writeLine(`CMD=@LOG "intention: ${v[1]}" YELLOW;`),this.showIntentionalTrial(c.class);let d=window.setTimeout(()=>{let b=c.class.split("->").map(Q=>Q.trim());this.hardwareService.writeLine(`CMD=@LOG "imagery: ${b[0]}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(c.class);let K=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),console.log("end"),t++,this.setProgress(100*t/e.length),P()},c.duration);n.push(K)},c.duration);n.push(d)},Y);n.push(J)};return P(),O}static \u0275fac=(()=>{let e;return function(t){return(e||(e=k(a)))(t||a)}})();static \u0275cmp=L({type:a,selectors:[["app-stimuli"]],features:[F],decls:28,vars:27,consts:[["matIconButton","","matTooltip","\u26A0\uFE0F Stop stimulus delivery",1,"stop","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Starting will begin stimulus delivery",1,"start","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Fullscreen will restart stimulus delivery",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Exiting fullscreen will restart stimulus delivery",3,"click","routerLink"],["matIconButton","","id","mode-light",3,"click"],["matIconButton","","id","mode-dark",3,"click"],[1,"bottom-left"],[1,"center","counter",3,"innerHTML"],[1,"center","fixation"],[1,"center","cue","conditional-visible",3,"intentional"],[1,"center","cue","conditional-visible",3,"visible"],["mode","determinate",3,"value"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(o(0,"div")(1,"button",0),m("click",function(){return t.stopSequence()}),o(2,"mat-icon"),l(3,"stop_circle"),s()(),o(4,"button",1),m("click",function(){return t.startCountdown()}),o(5,"mat-icon"),l(6,"play_circle"),s()(),o(7,"button",2),m("click",function(){return t.gotoFullWindow()}),o(8,"mat-icon"),l(9,"arrows_output"),s()(),o(10,"button",3),m("click",function(){return t.stopSequence()}),o(11,"mat-icon"),l(12,"fullscreen_exit"),s()(),o(13,"button",4),m("click",function(){return t.setReactiveMode("light")}),o(14,"mat-icon"),l(15,"light_mode"),s()(),o(16,"button",5),m("click",function(){return t.setReactiveMode("dark")}),o(17,"mat-icon"),l(18,"dark_mode"),s()(),C(19,"app-hardware",6)(20,"span",7),o(21,"mat-icon",8),l(22,"point_scan"),s(),M(23,U,2,3,"span",9,_),M(25,X,2,3,"span",10,_),C(27,"mat-progress-bar",11),s()),i&2&&(u(p("screen ",t.embeded)),r(),g("visible-b",t.onDelivery()),r(3),g("visible-b",!t.onDelivery()),r(3),u(p("bottom-right fullscreen ",t.embeded)),r(3),u(p("bottom-right appscreen ",t.embeded)),h("routerLink",D(t.normalWindowLink)),r(3),u(p("top-right mode-button ",t.embeded)),S("display",t.currentMode==="dark"?"flex":"none"),r(3),u(p("top-right mode-button ",t.embeded)),S("display",t.currentMode==="dark"?"none":"flex"),r(4),h("innerHTML",t.countdownTimer(),E),r(3),w(t.cues),r(2),w(t.intentionalCues),r(2),h("value",t.progressValue()))},dependencies:[R,q,A,W,H,B,G,N,z],styles:[".start[_ngcontent-%COMP%], .stop[_ngcontent-%COMP%]{scale:2}.conditional-visible-b.visible-b[_ngcontent-%COMP%]{visibility:visible}.conditional-visible-b[_ngcontent-%COMP%]{visibility:hidden}.screen[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-surface);width:100vw;height:100vh;position:relative;box-sizing:border-box;overflow:hidden}.screen.embeded[_ngcontent-%COMP%]{border-radius:var(--mat-sys-corner-large);width:100%;height:50vh;margin:0 auto}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.counter[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);font:var(--mat-sys-body-small);font-size:12vh}.fixation[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);z-index:9999}.bottom-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;bottom:16px}.bottom-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;bottom:16px}.top-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;top:16px}.top-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;top:16px}button.top-left[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], button.bottom-right[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:1em;height:1em}.stop[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.fullscreen[_ngcontent-%COMP%]{display:none}.appscreen[_ngcontent-%COMP%], .fullscreen.embeded[_ngcontent-%COMP%]{display:block}.appscreen.embeded[_ngcontent-%COMP%]{display:none}.mode-button.embeded[_ngcontent-%COMP%]{display:none!important}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}button[_ngcontent-%COMP%]{z-index:1000}",'.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em;font-size:20vh}.conditional-visible[_ngcontent-%COMP%]{visibility:hidden;pointer-events:none}.conditional-visible.intentional[_ngcontent-%COMP%]{visibility:visible;pointer-events:auto}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto}']})};export{$ as a};
