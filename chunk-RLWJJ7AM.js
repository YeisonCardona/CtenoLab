import{a as L,b as E,c as k}from"./chunk-YX44V3DK.js";import{c as I}from"./chunk-SDG2FXYZ.js";import{b as S}from"./chunk-PT4O7Y4Y.js";import{Ab as T,Bb as l,Cb as c,Kb as b,Sa as r,Wb as f,Yb as v,Zb as C,db as O,hb as P,ra as p,ua as _,wb as g,yb as d,zb as h}from"./chunk-TEXVEQLC.js";import{h as M,i as y}from"./chunk-5KHZBZE7.js";function R(o,e){if(o&1&&(l(0,"span",3),v(1),c()),o&2){let n=e.$implicit,t=b();f("intentional",t.showIcon()[n.class]),r(),C(n.value)}}function j(o,e){if(o&1&&(l(0,"span",3),v(1),c()),o&2){let n=e.$implicit,t=b();f("visible",t.showIntentionalIcon()[n.class]),r(),C(n.value)}}var D=class o extends E{cues=[];intentionalCues=[];showIcon=p(Object.fromEntries(this.cues.map(e=>[e.class,!1])));showIntentionalIcon=p(Object.fromEntries(this.intentionalCues.map(e=>[e.class,!1])));fullWindowLink="/experiments/motor-imagery/sequential/stimuli";normalWindowLink="/experiments/motor-imagery/sequential";startCountdownValue=5;ngOnInit(){return y(this,null,function*(){M(o.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Sequential Motor Imagery" CYAN 3;')})}generateTrials(){this.cues=this.experimentConfig.classes.map(n=>{let t=n.split("->").map(i=>i.trim());return{class:t[0],value:t[0]}}),this.intentionalCues=this.experimentConfig.classes.map(n=>{let t=n.split("->").map(i=>i.trim());return{class:t[1],value:t[1]}}),this.hardwareService.writeLine("CMD=@CLA;");let e=[];for(let n of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:n,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){let n;e!==null?n=e.split("->").map(i=>i.trim())[0]:n=null,this.showIcon.set(Object.fromEntries(this.cues.map(t=>[t.class,t.class===n])))}showIntentionalTrial(e){let n;e!==null?n=e.split("->").map(i=>i.trim())[1]:n=null,this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(t=>[t.class,t.class===n])))}stopStimuliSequence(){this.showTrial(null),this.showIntentionalTrial(null)}runStimuliSequence(){let e=this.generateTrials(),n=performance.now(),t=0,i=[],w=()=>{i.forEach(s=>window.clearTimeout(s)),i=[]},x=()=>{if(t>=e.length){w(),this.onDelivery.set(!1);return}let s=e[t],q=n+e.slice(0,t).reduce((m,a)=>m+a.duration+a.duration+a.soa,0),F=Math.max(0,q-performance.now()),N=window.setTimeout(()=>{let m=s.class.split("->").map(u=>u.trim());this.hardwareService.writeLine(`CMD=@LOG "intention: ${m[1]}" YELLOW;`),this.showIntentionalTrial(s.class);let a=window.setTimeout(()=>{let u=s.class.split("->").map(B=>B.trim());this.hardwareService.writeLine(`CMD=@LOG "imagery: ${u[0]}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(s.class);let z=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),console.log("end"),t++,this.setProgress(100*t/e.length),x()},s.duration);i.push(z)},s.duration);i.push(a)},F);i.push(N)};return x(),w}static \u0275fac=(()=>{let e;return function(t){return(e||(e=_(o)))(t||o)}})();static \u0275cmp=O({type:o,selectors:[["app-stimuli"]],features:[P],decls:5,vars:1,consts:[[3,"hostRef"],[1,"center","cue","conditional-visible",3,"intentional"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(n,t){n&1&&(l(0,"app-stimuli-layout",0),d(1,R,2,3,"span",1,g),d(3,j,2,3,"span",2,g),c()),n&2&&(T("hostRef",t),r(),h(t.cues),r(2),h(t.intentionalCues))},dependencies:[I,L,S,k],styles:[":root .light{--mat-button-toggle-text-color: #e3e2e6;--mat-button-toggle-background-color: transparent;--mat-button-toggle-selected-state-text-color: #dbe2f9;--mat-button-toggle-selected-state-background-color: #3f4759}  :root .dark{--mat-button-toggle-text-color: #1b1b1f;--mat-button-toggle-background-color: transparent;--mat-button-toggle-selected-state-text-color: #131b2c;--mat-button-toggle-selected-state-background-color: #dbe2f9}.start[_ngcontent-%COMP%], .stop[_ngcontent-%COMP%]{scale:2}.conditional-visible-b.visible-b[_ngcontent-%COMP%]{visibility:visible}.conditional-visible-b[_ngcontent-%COMP%]{visibility:hidden}.screen[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-surface);width:100vw;height:100vh;position:relative;box-sizing:border-box;overflow:hidden}.screen.embeded[_ngcontent-%COMP%]{border-radius:var(--mat-sys-corner-large);width:100%;height:50vh;margin:0 auto}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.counter[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);font:var(--mat-sys-body-small);font-size:12vh}.fixation[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);z-index:9999}.bottom-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;bottom:16px}.bottom-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;bottom:16px}.top-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;top:16px}.top-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;top:16px}button.top-left[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], button.bottom-right[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:1em;height:1em}.stop[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.fullscreen[_ngcontent-%COMP%]{display:none}.appscreen[_ngcontent-%COMP%], .fullscreen.embeded[_ngcontent-%COMP%]{display:block}.appscreen.embeded[_ngcontent-%COMP%]{display:none}.mode-button.embeded[_ngcontent-%COMP%]{display:none!important}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}button[_ngcontent-%COMP%]{z-index:1000}",'.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em;font-size:20vh}.conditional-visible[_ngcontent-%COMP%]{visibility:hidden;pointer-events:none}.conditional-visible.intentional[_ngcontent-%COMP%]{visibility:visible;pointer-events:auto}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto}']})};export{D as a};
