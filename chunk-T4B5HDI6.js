import{a as A,b as f,c as G,d as N}from"./chunk-D7WD6YWT.js";import{b as R,c as P}from"./chunk-62AV6QVL.js";import{b as k}from"./chunk-7J34S6W5.js";import{$b as D,Ab as x,Bb as p,Cb as h,Mb as E,Sa as d,Yb as M,_b as O,db as T,hb as b,ra as u,tb as I,ua as C,wb as S,yb as L,zb as _}from"./chunk-P6GYV7WW.js";import{h as m,i as v,j as y}from"./chunk-HVQDNULJ.js";function q(g,e){if(g&1&&(p(0,"mat-icon",3,0),O(2),h()),g&2){let i=e.$implicit,t=e.$index,n=E(),r=n.intentionalCues[t];M("visible",n.showIcon()[i.class])("intentional",n.showIntentionalIcon()[r.class]),I("cue-key",n.fixClass(i.class)),d(2),D(i.value)}}var s=class s extends G{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"}];intentionalCues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"}];showIcon=u(Object.fromEntries(this.cues.map(e=>[e.class,!1])));showIntentionalIcon=u(Object.fromEntries(this.intentionalCues.map(e=>[e.class,!1])));fullWindowLink="/paradigms/motor-imagery/directional/stimuli";normalWindowLink="/paradigms/motor-imagery/directional";startCountdownValue=5;ngOnInit(){return y(this,null,function*(){v(s.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Directional Motor Imagery" BLUE 3;')})}generateTrials(){let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){console.log(e),this.showIcon.set(Object.fromEntries(this.cues.map(i=>[i.class,i.class===e])))}setOpacity(e,i){let t=this.cuesElement.find(n=>n._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(e));t&&(t._elementRef.nativeElement.style.opacity=i.toString())}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,n=[],r=()=>{n.forEach(a=>window.clearTimeout(a)),n=[]},w=()=>{if(t>=e.length){r(),this.onDelivery.set(!1);return}let a=e[t],$=i+e.slice(0,t).reduce((l,o)=>l+o.duration+o.duration+o.soa,0),B=Math.max(0,$-performance.now()),U=window.setTimeout(()=>{let[l,o]=a.class.split("-").map(c=>c.trim());this.hardwareService.writeLine(`CMD=@LOG "From: ${l}" GREEN;`),this.showTrial(l);let j=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "To: ${o}" GREEN;`),this.showTrial(o),console.log("trial");let c=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.hardwareService.writeLine(`CMD=@LOG "Trial End: ${a.class}" ORANGE;`),this.showTrial(null),console.log("end"),t++,this.setProgress(100*t/e.length),w()},a.duration);n.push(c)},a.duration);n.push(j)},B);n.push(U)};return w(),r}static \u0275fac=(()=>{let e;return function(t){return(e||(e=C(s)))(t||s)}})();static \u0275cmp=T({type:s,selectors:[["app-stimuli"]],features:[b],decls:3,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible","intentional"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(p(0,"app-stimuli-layout",1),L(1,q,3,6,"mat-icon",2,S),h()),i&2&&(x("hostRef",t),d(),_(t.cues))},dependencies:[P,R,A,k,N],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;transition:opacity .3s ease,font-size .3s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;font-size:50vh}"]})};m([f("TRIAL",{arguments:["CLASS"],example:"Trial Right",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],s.prototype,"showTrial",1),m([f("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Right 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],s.prototype,"setOpacity",1);var F=s;export{F as a};
