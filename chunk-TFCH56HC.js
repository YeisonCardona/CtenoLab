import{a as se}from"./chunk-KBVX7E3U.js";import{a as ee,b as te,c as ie,d as ae,e as re,f as ne}from"./chunk-KVASGOW7.js";import{k as Z}from"./chunk-DUXI72MP.js";import{b as X,c as Y}from"./chunk-YGJZO764.js";import"./chunk-FDI5VVZL.js";import{a as J}from"./chunk-TC42CYHG.js";import"./chunk-5E6RAWY4.js";import"./chunk-4PHGQJCB.js";import"./chunk-4H2BPYRN.js";import{c as Q}from"./chunk-FNTTNCNS.js";import"./chunk-JQYROLX5.js";import{a as G,b as U,f as K}from"./chunk-5ZKSSP3E.js";import"./chunk-IXPZEY46.js";import"./chunk-DIONBDFX.js";import{a as O,b as z}from"./chunk-OAVLZCYW.js";import{b as W}from"./chunk-RRXYPN2E.js";import"./chunk-NP432326.js";import"./chunk-2UE2V2R5.js";import"./chunk-Q7G7UQXQ.js";import{b as N}from"./chunk-H53LNFG5.js";import"./chunk-VVJ3YVZY.js";import"./chunk-O3YAIXEY.js";import{b as B}from"./chunk-XRGWM46W.js";import"./chunk-EBVX5MXQ.js";import"./chunk-KKFSZARV.js";import{a as L}from"./chunk-TLAT6ZHR.js";import{h as q}from"./chunk-6MKFGCP3.js";import"./chunk-ZJIUVY4T.js";import"./chunk-CR4H4DNL.js";import"./chunk-WDA2SWQK.js";import"./chunk-EVU24ONZ.js";import{a as R,c as H}from"./chunk-JW5YZPO3.js";import{i as F,k as V,n as j}from"./chunk-NRSOVIAX.js";import{m as A}from"./chunk-4SNU4EVC.js";import{$b as E,Ab as l,Bb as s,Cb as n,Db as p,Hb as w,Lb as y,Mb as M,Pa as v,Qa as T,Sa as r,Xa as c,_b as b,bc as I,db as D,ga as f,gc as $,ha as g,hb as P,sc as x,ub as C,vb as k}from"./chunk-JNWBK6C6.js";import"./chunk-GV7GV3NK.js";function le(u,S){if(u&1&&p(0,"app-diagram",6),u&2){let i=M();l("diagram",i.diagram())}}function me(u,S){if(u&1){let i=w();s(0,"mat-tab",17),p(1,"div",18),s(2,"app-markers",19),y("stimulusMarkersMapData",function(e){f(i);let a=M();return g(a.setStimulusMarkersMapData(e))})("stimulusMarkersMap",function(e){f(i);let a=M();return g(a.setStimulusMarkersMap(e))}),n()(),s(3,"mat-tab",20),p(4,"app-layout-commands",21),n(),s(5,"mat-tab",22),p(6,"div",18)(7,"app-specification",23),n()}if(u&2){let i=M();r(2),l("stimulusCommandMap",i.stimulusCommandMap),r(2),l("commandRegistryMap",i.commandRegistry)("stimulusCommandMap",i.stimulusCommandMap)("hardwareIP",i.hardwareService.hardwareIP()),r(3),l("stimulusMarkersMapData",i.stimulusMarkersMapData)("experimentConfig",i.formData)("stimuli_delivery_link",i.currentUrl+i.getFullWindowLink("/stimuli"))}}function pe(u,S){u&1&&p(0,"mat-tab",24)(1,"mat-tab",25)(2,"mat-tab",26)}var oe=class u extends ne{constructor(i,t,e,a,o,m,d){super(i,t,e,a,o);this.navigationService=m;this.breadcrumbService=d;this.navigationService.setActiveLink("/paradigms/p300/speller"),this.breadcrumbService.setBreadcrumbs([{label:"Home",url:"/home"},{label:"Paradigms",url:"/paradigms"},{label:"P300",url:"/paradigms/p300"},{label:"Speller",url:"/paradigms/p300/speller"}])}requieredTier="Basic";storageKey="speller-p300";resetValues(){this.formData.set({flash_duration:125,target_duration:1e3,target_probability:10,repetitions_per_target:300,soa_inter_trial:200,soa_intra_trial:1e3,target_characters:15})}summary=x(()=>{let i=this.formData();if(!i||Object.keys(i).length===0)return"";let t=[],e=i.target_characters,a=i.soa_inter_trial,o=Math.round(((i.flash_duration+i.soa_inter_trial)*i.repetitions_per_target*e+i.target_duration*e+i.soa_intra_trial*e)/6e4);e>1e3&&t.push("The total number of trials exceeds 1000. This may lead to participant fatigue."),o>30&&t.push("Estimated experiment duration exceeds 30 minutes. Consider reducing trials or stimulus duration.");let m=t.length?`<p class="warning"><b>\u26A0\uFE0F Warnings:</b><br>${t.map(d=>`\u2022 ${d}`).join("<br>")}</p>`:"";return`
    <p class="summary-block">
      <b>Total trials</b>: ${e}<br>
      <b>Stimulus duration</b>: ${i.flash_duration} ms<br>
      <b>SOA</b>: ${a} ms<br>
      <b>Estimated duration</b>: ${o} min
    </p>
    ${m}
  `});experiment={name:"P300 Speller",description:"This experiment implements a matrix-based <b>P300 speller paradigm</b> in which rows and columns of a <b>character grid</b> flash in rapid succession. Participants focus on a specific letter or symbol within the matrix, and a <b>P300 response</b> is elicited when the row or column containing the target character is highlighted. This paradigm is widely used for <b>non-verbal communication</b> and <b>attention-based BCI systems</b>.",objective:"The objective of this experiment is to determine the feasibility of decoding <b>user intent</b> by detecting <b>P300 components</b> elicited during attention to specific characters. By analyzing the brain's response to row and column flashes, the system can identify the target character being attended, enabling <b>spelling without motor output</b>.",procedure:"Participants are seated in front of a grid (e.g., <b>6\xD76 matrix</b>) containing letters, numbers, or symbols. Each trial consists of a rapid sequence of <b>row and column flashes</b>, presented in random order. The participant focuses on a specific character, and silently counts or attends each time its <b>row or column</b> is illuminated. Stimuli are presented for brief durations (typically <b>100\u2013200 ms</b> per flash), with short inter-stimulus intervals. The EEG signal is continuously recorded and analyzed to detect <b>P300 responses</b> corresponding to the target row and column. A session may include <b>multiple target selections</b> and typically lasts <b>20\u201330 minutes</b>."};stimulusCommandMap={A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",_:"_",Target:"*t",NonTarget:"*n",Feedback:"*f"};formField=[{type:"slider",key:"flash_duration",label:"Flash Duration",value:125,min:10,max:1e3,step:1,suffix:"ms",hint:"Duration of each flash stimulus"},{type:"slider",key:"target_duration",label:"Target Duration",value:1e3,min:500,max:2e3,step:1,suffix:"ms",hint:"How long each target character is displayed"},{type:"slider",key:"target_probability",label:"Target",value:10,min:1,max:100,step:1,suffix:"%",hint:"Percentage of trials that will show the target stimulus."},{type:"slider",key:"repetitions_per_target",label:"Repetitions per Target",value:300,min:1,max:1e3,step:1,suffix:"times",hint:"Number of times each target is flashed during selection."},{type:"slider",key:"soa_inter_trial",label:"Inter-Trial SOA (ms)",value:200,min:0,max:1e3,step:1,suffix:"ms",hint:"Delay between the onset of consecutive stimuli (i.e., between trials)"},{type:"slider",key:"soa_intra_trial",label:"Intra-Trial SOA (ms)",value:1e3,min:100,max:2e3,step:10,suffix:"ms",hint:"Delay between consecutive flashes within a single trial"},{type:"slider",key:"target_characters",label:"Target Characters",value:15,min:1,max:50,step:1,suffix:"chars",hint:"Number of distinct letters to be spelled during the experiment."}];diagram=x(()=>{let t=this.formData();if(Object.keys(t).length===0)return{height:"0",blocks:[]};let e=t.target_duration+t.flash_duration*5+t.soa_inter_trial*5+t.soa_intra_trial,a=t.target_duration/e*100,o=t.flash_duration/e*100,m=t.soa_inter_trial/e*100,d=t.soa_intra_trial/e*100,h=[{name:"soa",label:`Stimulus Onset Asynchonously<br>Randomized Delay: ${t.soa_intra_trial} ms`,width:`${d}%`},{name:"cue2",label:`Target Presentation<br>Duration: ${t.target_duration} ms`,left:`${d}%`,width:`${a}%`},{name:"marker",label:"Marker Encoding<br>(Synchronization Trigger)",bottom:"205px",left:`${d}%`,width:`${a}%`,height:"50px"}];for(let _=0;_<5;_++)h.push({name:"cue",label:"Column or Row Activation",left:`${d+a+(m+o)*_}%`,width:`${o}%`,vertical:!0}),h.push({name:"soa",label:"Inter-Stimulus Asynchrony",left:`${d+a+o+(m+o)*_}%`,width:`${m}%`,vertical:!0}),h.push({name:"marker",label:"Marker",bottom:"205px",left:`${d+a+(m+o)*_}%`,width:`${o+m}%`,height:"50px"});return h.push(),{height:"250px",blocks:h.flat(),context:`A target character is presented for <b>${t.target_duration} ms</b>, followed by a sequence of <b>row and column
      flashes</b> (${t.flash_duration} ms). An <b>inter-trial SOA</b> of <b>${t.soa_inter_trial} ms</b> separates each row/column flash.
      After <b>${t.repetitions_per_target} flashes</b>, a <b>${t.soa_intra_trial} ms</b> pause occurs before the next character. Digital markers synchronize flashes
      with EEG/BCI recordings.`}});static \u0275fac=function(t){return new(t||u)(c(R),c(H),c(N),c(Q),c(W),c(O),c(z))};static \u0275cmp=D({type:u,selectors:[["app-p300-speller"]],features:[P],decls:37,vars:20,consts:[["taskPanel",""],["tabGroup",""],["formComponent",""],[1,"no-margin-bottom"],[1,"align-justify",3,"innerHTML"],[1,"grid-responsive-2"],[3,"diagram"],["dynamicHeight","","mat-stretch-tabs","","animationDuration","100ms",1,"example-stretched-tabs","mat-elevation-z4"],["label","Stimuli Delivery"],[1,"margin-bottom-small"],[3,"valueChange","config","columns","storageKey"],[1,"margin-top-large",3,"innerHTML"],[1,"flex-row","flex-row-left"],[1,"elipsis-96",3,"href"],["matIconButton","",3,"cdkCopyToClipboard"],["matButton","filled",1,"margin-top-large","margin-bottom-large",3,"click"],[3,"commandRegistry","formData","embedded","stimulusCommandMap","stimulusMarkersMap"],["label","Markers Generation"],[1,"margin-top-large"],[3,"stimulusMarkersMapData","stimulusMarkersMap","stimulusCommandMap"],["label","Neurofeedback & Runtime Events"],[3,"commandRegistryMap","stimulusCommandMap","hardwareIP"],["label","Specification"],[3,"stimulusMarkersMapData","experimentConfig","stimuli_delivery_link"],["label","Markers Generation","disabled",""],["label","Neurofeedback & Runtime Events","disabled",""],["label","Specification","disabled",""]],template:function(t,e){if(t&1){let a=w();s(0,"div",null,0)(2,"h1",3),b(3),n(),p(4,"p",4),s(5,"div",5)(6,"div")(7,"h2",3),b(8,"Objective"),n(),p(9,"p",4),n(),s(10,"div")(11,"h2",3),b(12,"Procedure"),n(),p(13,"p",4),n()(),C(14,le,1,1,"app-diagram",6),p(15,"mat-divider"),s(16,"mat-tab-group",7,1)(18,"mat-tab",8),p(19,"div",9),s(20,"app-inputs",10,2),y("valueChange",function(m){return f(a),g(e.onFormValueChange(m))}),n(),p(22,"div",11),s(23,"p",12)(24,"span")(25,"b"),b(26,"Direct experiment link:"),n()(),s(27,"a",13),b(28),n(),s(29,"button",14)(30,"mat-icon"),b(31,"content_copy"),n()()(),s(32,"button",15),y("click",function(){return f(a),g(e.loadDefaultValues())}),b(33,"Load Default Values"),n(),s(34,"app-stimuli",16),y("commandRegistry",function(m){return f(a),g(e.setCommandRegistry(m))}),n()(),C(35,me,8,7)(36,pe,3,0),n()()}t&2&&(r(3),E(e.experiment.name),r(),l("innerHTML",e.experiment.description,v),r(5),l("innerHTML",e.experiment.objective,v),r(4),l("innerHTML",e.experiment.procedure,v),r(),k(e.diagram()?14:-1),r(6),l("config",e.formField)("columns",e.columns)("storageKey",e.storageKey),r(2),l("innerHTML",e.summary(),v),r(5),l("href",$("",e.currentUrl,"",e.getFullWindowLink("/stimuli")),T),r(),I(" ",e.currentUrl,"",e.getFullWindowLink("/stimuli")," "),r(),l("cdkCopyToClipboard",e.currentUrl+e.getFullWindowLink("/stimuli")),r(5),l("formData",e.formData)("embedded","embedded")("stimulusCommandMap",e.stimulusCommandMap)("stimulusMarkersMap",e.stimulusMarkersMap),r(),k(e.isStimulusCommandMapEmpty()?36:35))},dependencies:[se,A,K,G,U,B,ee,j,V,F,Y,X,Z,te,q,J,L,ae,ie,re],encapsulation:2})};export{oe as P300Speller};
