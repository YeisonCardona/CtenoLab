import{a as D,b as E,c as _}from"./chunk-7SFZJKQS.js";import{c as L}from"./chunk-RMWCCIY2.js";import{b as O}from"./chunk-CZTA7AJK.js";import{$b as I,Ab as T,Bb as l,Cb as c,Mb as x,Sa as a,Yb as M,_b as S,db as w,hb as v,ra as f,ua as g,wb as y,yb as C,zb as b}from"./chunk-HXPFIK5A.js";import{h as d,i as h}from"./chunk-5KHZBZE7.js";function B(s,e){if(s&1&&(l(0,"span",2),S(1),c()),s&2){let t=e.$implicit,i=x();M("visible",i.showIcon()[t.class]),a(),I(t.value)}}var P=class s extends E{cues=[];showIcon=f(Object.fromEntries(this.cues.map(e=>[e.class,!1])));fullWindowLink="/experiments/motor-imagery/wordcued/stimuli";normalWindowLink="/experiments/motor-imagery/wordcued";startCountdownValue=5;ngOnInit(){return h(this,null,function*(){d(s.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Word-Cued Motor Imagery" CYAN 3;'),this.cues=Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]}))})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let e=[];for(let t of this.experimentConfig.classes)for(let i=0;i<this.experimentConfig.trials_per_class;i++)e.push({class:t,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.showIcon.set(Object.fromEntries(this.cues.map(t=>[t.class,t.class===e])))}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let e=this.generateTrials(),t=performance.now(),i=0,r=[],m=()=>{r.forEach(n=>window.clearTimeout(n)),r=[]},u=()=>{if(i>=e.length){m(),this.onDelivery.set(!1);return}let n=e[i],k=t+e.slice(0,i).reduce((o,p)=>o+p.duration+p.soa,0),F=Math.max(0,k-performance.now()),R=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "${n.class}" GREEN;`),this.showTrial(n.class);let o=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),i++,this.setProgress(100*i/e.length),u()},n.duration);r.push(o)},F);r.push(R)};return u(),m}static \u0275fac=(()=>{let e;return function(i){return(e||(e=g(s)))(i||s)}})();static \u0275cmp=w({type:s,selectors:[["app-stimuli"]],features:[v],decls:3,vars:1,consts:[[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(t,i){t&1&&(l(0,"app-stimuli-layout",0),C(1,B,2,3,"span",1,y),c()),t&2&&(T("hostRef",i),a(),b(i.cues))},dependencies:[L,D,O,_],styles:['.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-size:10vh;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}']})};export{P as a};
