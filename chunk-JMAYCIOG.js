import{a as G}from"./chunk-267TKMII.js";import{c as N}from"./chunk-4PHGQJCB.js";import{a as B,b as f,c as q,d as Y}from"./chunk-4H2BPYRN.js";import{k as U}from"./chunk-FNTTNCNS.js";import{c as D}from"./chunk-XRGWM46W.js";import{b as A}from"./chunk-EBVX5MXQ.js";import{c as F}from"./chunk-KKFSZARV.js";import{Ab as _,Bb as m,Cb as d,Mb as I,Sa as l,Yb as p,Zb as L,_b as P,ac as R,db as k,hb as x,ra as w,tb as M,ua as y,wb as S,yb as E,zb as O}from"./chunk-JNWBK6C6.js";import{i as u,j as T,k as b}from"./chunk-GV7GV3NK.js";function Z(h,e){if(h&1&&(m(0,"div",4,0),P(2),d()),h&2){let i=e.$implicit,t=I();L(t.fixClass(i.class)),p("visible",t.showIcon()[i.class]),M("cue-key",t.fixClass(i.class))("flicker-frequency",i.value),l(2),R(" ",i.value," Hz ")}}var n=class n extends q{showIcon=w(Object.fromEntries(this.cues().map(e=>[e.class,!1])));fullWindowLink="/paradigms/ssvep/direction/stimuli";normalWindowLink="/paradigms/ssvep/direction";startCountdownValue=5;flickers=[];ngOnInit(){return b(this,null,function*(){T(n.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE TEXT="SSVEP Direction" COLOR=BLUE SIZE=3;')})}generateCues(){this.cues.set([{class:"Up",value:"12"},{class:"Right",value:"16"},{class:"Down",value:"20"},{class:"Left",value:"24"}])}generateTrials(){let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,soa:this.experimentConfig.soa,flicker_duration:this.experimentConfig.flicker_duration});return this.setFlickers(),e=this.shuffle(e),e}setFlickers(){let e=this.experimentConfig.refresh_rate;this.flickers=[],this.cuesDivElement.forEach(i=>{let t=Number(i.nativeElement.getAttribute("flicker-frequency"));this.flickers.push(new G(i,t,e))})}showTrial(e){this.showIcon.set(Object.fromEntries(this.cues().map(i=>[i.class,i.class===e])))}setOpacity(e,i){let t=this.cuesIconElement.find(r=>r._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(e));t&&(t._elementRef.nativeElement.style.opacity=i.toString())}stopStimuliSequence(){this.showTrial(null),this.flickers.forEach(e=>e.stop())}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,r=[],z=s=>{let o=i+e.slice(0,s).reduce((c,a)=>c+a.duration+(a.flicker_duration||0)+a.soa,0);return Math.max(0,o-performance.now())},V=s=>{this.showTrial(s.class),this.hardwareService.writeLine(`CMD=@LOG MESSAGE="Class: ${s.class}" COLOR=GREEN;`)},H=()=>{t++,this.setProgress(100*t/e.length)},W=s=>{this.flickers.forEach(o=>o.start()),this.propagateClassMarker(s.class)},g=()=>{this.flickers.forEach(s=>s.stop())},v=()=>{r.forEach(s=>window.clearTimeout(s)),r=[],g()},C=()=>{if(t>=e.length){v(),this.onDelivery.set(!1);return}let s=e[t],o=z(t),c=window.setTimeout(()=>{V(s);let a=window.setTimeout(()=>{this.showTrial(null);let $=window.setTimeout(()=>{W(s);let X=window.setTimeout(()=>{g(),H(),C()},s.flicker_duration||0);r.push(X)},300);r.push($)},s.duration);r.push(a)},o);r.push(c)};return C(),v}static \u0275fac=(()=>{let e;return function(t){return(e||(e=y(n)))(t||n)}})();static \u0275cmp=k({type:n,selectors:[["app-stimuli"]],features:[x],decls:4,vars:3,consts:[["cueElement",""],[3,"hostRef"],[1,"ssvep-direction-container"],[1,"cue","flicker","conditional-visible",3,"class","visible"],[1,"cue","flicker","conditional-visible"]],template:function(i,t){i&1&&(m(0,"app-stimuli-layout",1)(1,"div",2),E(2,Z,3,7,"div",3,S),d()()),i&2&&(_("hostRef",t),l(),p("embedded",t.embedded==="embedded"),l(),O(t.cues()))},dependencies:[D,B,A,N,U,Y,F],styles:[".ssvep-direction-container[_ngcontent-%COMP%]{position:relative;height:90%;aspect-ratio:1;margin:auto;padding:100px;box-sizing:border-box}.ssvep-direction-container.embedded[_ngcontent-%COMP%]{transform:translateY(5%)}.cue[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-on-surface);width:15%;aspect-ratio:1;position:absolute;border-radius:10%;display:flex;align-items:center;justify-content:center;color:color-mix(in srgb,var(--mat-sys-primary) 30%,transparent)}.cue.Up[_ngcontent-%COMP%]{top:0;left:50%;transform:translate(-50%)}.cue.Down[_ngcontent-%COMP%]{bottom:0;left:50%;transform:translate(-50%)}.cue.Left[_ngcontent-%COMP%]{top:50%;left:0;transform:translateY(-50%)}.cue.Right[_ngcontent-%COMP%]{top:50%;right:0;transform:translateY(-50%)}.cue.visible[_ngcontent-%COMP%]{border:10px solid var(--mat-sys-error);box-sizing:border-box}"]})};u([f("TRIAL",{arguments:["CLASS"],example:"Trial Right",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],n.prototype,"showTrial",1),u([f("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Right 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],n.prototype,"setOpacity",1);var j=n;export{j as a};
