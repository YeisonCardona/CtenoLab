import{a as ee}from"./chunk-AKND43OA.js";import{b as J,c as K}from"./chunk-6KV7LSDN.js";import{a as H,c as Q,d as Z}from"./chunk-U47MJ6K3.js";import{j as Y,o as $}from"./chunk-GSX2IYNF.js";import{V as G,_ as W}from"./chunk-HY2ZGKZK.js";import{Ab as i,Bb as o,Cb as u,Eb as N,Gb as h,Lb as L,Mb as q,Nb as j,Qa as E,Sb as l,Ta as a,Tb as d,Ub as p,Vb as m,Xa as z,Ya as w,_ as k,a as S,aa as P,ca as f,dc as _,eb as M,fb as B,ha as g,ia as b,kb as V,lb as D,sa as v,sb as A,sc as U,tb as X,ua as R,ub as F,vc as T,xa as O,zb as x}from"./chunk-FNJOAVBV.js";function le(s,r){s&1&&u(0,"div",2)}var ce=new P("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var re=(()=>{class s{_elementRef=f(O);_ngZone=f(D);_changeDetectorRef=f(U);_renderer=f(z);_cleanupTransitionEnd;constructor(){let t=f(ce,{optional:!0});t&&(t.color&&(this.color=this._defaultColor=t.color),this.mode=t.mode||this.mode)}_isNoopAnimation=G();get color(){return this._color||this._defaultColor}set color(t){this._color=t}_color;_defaultColor="primary";get value(){return this._value}set value(t){this._value=te(t||0),this._changeDetectorRef.markForCheck()}_value=0;get bufferValue(){return this._bufferValue||0}set bufferValue(t){this._bufferValue=te(t||0),this._changeDetectorRef.markForCheck()}_bufferValue=0;animationEnd=new V;get mode(){return this._mode}set mode(t){this._mode=t,this._changeDetectorRef.markForCheck()}_mode="determinate";ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._cleanupTransitionEnd=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._transitionendHandler)})}ngOnDestroy(){this._cleanupTransitionEnd?.()}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}_transitionendHandler=t=>{this.animationEnd.observers.length===0||!t.target||!t.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))};static \u0275fac=function(e){return new(e||s)};static \u0275cmp=M({type:s,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(e,n){e&2&&(A("aria-valuenow",n._isIndeterminate()?null:n.value)("mode",n.mode),p("mat-"+n.color),d("_mat-animation-noopable",n._isNoopAnimation)("mdc-linear-progress--animation-ready",!n._isNoopAnimation)("mdc-linear-progress--indeterminate",n._isIndeterminate()))},inputs:{color:"color",value:[2,"value","value",T],bufferValue:[2,"bufferValue","bufferValue",T],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],decls:7,vars:5,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(e,n){e&1&&(i(0,"div",0),u(1,"div",1),X(2,le,1,0,"div",2),o(),i(3,"div",3),u(4,"span",4),o(),i(5,"div",5),u(6,"span",4),o()),e&2&&(a(),l("flex-basis",n._getBufferBarFlexBasis()),a(),F(n.mode==="buffer"?2:-1),a(),l("transform",n._getPrimaryBarTransform()))},styles:[`.mat-mdc-progress-bar{display:block;text-align:start}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:max(var(--mat-progress-bar-track-height, 4px),var(--mat-progress-bar-active-indicator-height, 4px))}@media(forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:var(--mat-progress-bar-active-indicator-height, 4px)}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}[dir=rtl] .mdc-linear-progress__bar{right:0;transform-origin:center right}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid;border-color:var(--mat-progress-bar-active-indicator-color, var(--mat-sys-primary));border-top-width:var(--mat-progress-bar-active-indicator-height, 4px)}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden;height:var(--mat-progress-bar-track-height, 4px);border-radius:var(--mat-progress-bar-track-shape, var(--mat-sys-corner-none))}.mdc-linear-progress__buffer-dots{-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");background-repeat:repeat-x;flex:auto;transform:rotate(180deg);animation:mdc-linear-progress-buffering 250ms infinite linear;background-color:var(--mat-progress-bar-track-color, var(--mat-sys-surface-variant))}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}[dir=rtl] .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);background-color:var(--mat-progress-bar-track-color, var(--mat-sys-surface-variant))}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mat-progress-bar-track-height, 4px) * -2.5))}}@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(83.67142%)}100%{transform:translateX(200.611057%)}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(84.386165%)}100%{transform:translateX(160.277782%)}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(-83.67142%)}100%{transform:translateX(-200.611057%)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(-37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(-84.386165%)}100%{transform:translateX(-160.277782%)}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}
`],encapsulation:2,changeDetection:0})}return s})();function te(s,r=0,t=100){return Math.max(r,Math.min(t,s))}var ne=(()=>{class s{static \u0275fac=function(e){return new(e||s)};static \u0275mod=B({type:s});static \u0275inj=k({imports:[W]})}return s})();var ue=["containerRef"],ie=class s{constructor(r,t,e){this.route=r;this.themeService=t;this.router=e;this.currentMode=t.getCurrentMode()}experimentConfig;embeded;experiment=[];cues;countdownTimer=v("");onDelivery=v(!1);progressValue=v(0);showIcon=v({Right:!1,Left:!1,Up:!1,Down:!1});cancelStimuliSequence=null;countdownTimeoutId=null;countdownIntervalId=null;containerRef;scaledFontSize=100;currentMode="auto";setReactiveMode(r){this.themeService.setThemeMode(r),this.currentMode=r}shuffle(r){let t=[...r];for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}ngOnChanges(r){if(r.experimentConfig&&this.experimentConfig.classes){this.experiment=[];for(let t of this.experimentConfig.classes)for(let e=0;e<this.experimentConfig.trials_per_class;e++)this.experiment.push({class:t,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});this.experiment=this.shuffle(this.experiment)}}navigateWithQueryParams(){let r=this.experimentConfig;this.router.navigate(["/experiments/motor-imagery/unilateral/stimuli"],{queryParams:{classes:r.classes.join(","),trials:r.trials_per_class,duration:r.stimulus_duration,soa:r.soa.join(",")}})}ngOnInit(){if(this.route.queryParams.subscribe(r=>{if(Object.keys(r).length===0){console.warn("\u26A0\uFE0F No hay par\xE1metros en la URL");return}try{this.experimentConfig={classes:r.classes?.split(",")??[],trials_per_class:parseInt(r.trials,10),stimulus_duration:parseInt(r.duration,10),soa:r.soa?.split(",").map(t=>parseInt(t,10))??[]},this.ngOnChanges({experimentConfig:{currentValue:this.experimentConfig,previousValue:void 0,firstChange:!0,isFirstChange:()=>!0}})}catch{}}),this.embeded)document.exitFullscreen&&document.exitFullscreen();else{let r=document.documentElement;r.requestFullscreen&&r.requestFullscreen()}this.cues={Right:"arrow_right_alt",Left:"arrow_right_alt",Up:"arrow_right_alt",Down:"arrow_right_alt"}}ngAfterViewInit(){setTimeout(()=>{let r=this.containerRef.nativeElement;new ResizeObserver(e=>{for(let n of e){let c=n.contentRect.height;this.scaledFontSize=Math.max(100,c*.5)}}).observe(r)})}getRandomSoa(r){let t=r[0],e=r[1];return Math.floor(Math.random()*(e-t+1))+t}showTrial(r){this.showIcon.set(S({Right:!1,Left:!1,Up:!1,Down:!1},r?{[r]:!0}:{}))}stopSequence(){this.countdownTimeoutId!==null&&(clearTimeout(this.countdownTimeoutId),this.countdownTimeoutId=null),this.countdownIntervalId!==null&&(clearInterval(this.countdownIntervalId),this.countdownIntervalId=null),this.cancelStimuliSequence?.(),this.cancelStimuliSequence=null,this.showTrial(null),this.countdownTimer.set(""),this.onDelivery.set(!1)}startCountdown(){this.onDelivery.set(!0),this.countdownTimeoutId=window.setTimeout(()=>{this.countdownTimer.set(5),this.countdownIntervalId=window.setInterval(()=>{let r=this.countdownTimer();r>1?this.countdownTimer.set(r-1):(this.countdownIntervalId!==null&&(clearInterval(this.countdownIntervalId),this.countdownIntervalId=null),this.countdownTimer.set(""),this.countdownTimeoutId=window.setTimeout(()=>{this.cancelStimuliSequence=this.runStimuliSequence()},1e3))},1e3)},1e3)}runStimuliSequence(){let r=performance.now(),t=0,e=[],n=()=>{e.forEach(y=>window.clearTimeout(y)),e=[]},c=()=>{if(t>=this.experiment.length){n(),this.onDelivery.set(!1);return}let y=this.experiment[t],ae=r+this.experiment.slice(0,t).reduce((C,I)=>C+I.duration+I.soa,0),oe=Math.max(0,ae-performance.now()),se=window.setTimeout(()=>{this.showTrial(y.class);let C=window.setTimeout(()=>{this.showTrial(null),t++,this.progressValue.set(100*t/this.experiment.length),c()},y.duration);e.push(C)},oe);e.push(se)};return c(),n}static \u0275fac=function(t){return new(t||s)(w(H),w(ee),w(Q))};static \u0275cmp=M({type:s,selectors:[["app-stimuli"]],viewQuery:function(t,e){if(t&1&&L(ue,5),t&2){let n;q(n=j())&&(e.containerRef=n.first)}},inputs:{experimentConfig:"experimentConfig",embeded:"embeded"},features:[R],decls:32,vars:41,consts:[["containerRef",""],["matIconButton","",1,"stop","conditional-visible","top-left",3,"click"],["matIconButton","",1,"start","conditional-visible","top-left",3,"click"],["matIconButton","",3,"click"],["matIconButton","","routerLink","/experiments/motor-imagery/unilateral"],["matIconButton","","id","mode-light",3,"click"],["matIconButton","","id","mode-dark",3,"click"],[1,"center","counter",3,"innerHTML"],[1,"center","fixation"],[1,"center","cue","conditional-visible"],["mode","determinate",3,"value"]],template:function(t,e){if(t&1){let n=N();i(0,"div",null,0)(2,"button",1),h("click",function(){return g(n),b(e.stopSequence())}),i(3,"mat-icon"),m(4,"close"),o()(),i(5,"button",2),h("click",function(){return g(n),b(e.startCountdown())}),i(6,"mat-icon"),m(7,"play_arrow"),o()(),i(8,"button",3),h("click",function(){return g(n),b(e.navigateWithQueryParams())}),i(9,"mat-icon"),m(10,"arrows_output"),o()(),i(11,"button",4)(12,"mat-icon"),m(13,"fullscreen_exit"),o()(),i(14,"button",5),h("click",function(){return g(n),b(e.setReactiveMode("light"))}),i(15,"mat-icon"),m(16,"light_mode"),o()(),i(17,"button",6),h("click",function(){return g(n),b(e.setReactiveMode("dark"))}),i(18,"mat-icon"),m(19,"dark_mode"),o()(),u(20,"span",7),i(21,"mat-icon",8),m(22,"point_scan"),o(),i(23,"mat-icon",9),m(24,"arrow_forward"),o(),i(25,"mat-icon",9),m(26,"arrow_back"),o(),i(27,"mat-icon",9),m(28,"arrow_upward"),o(),i(29,"mat-icon",9),m(30,"arrow_forward"),o(),u(31,"mat-progress-bar",10),o()}t&2&&(p(_("screen ",e.embeded)),a(2),d("visible",e.onDelivery()),a(3),d("visible",!e.onDelivery()),a(3),p(_("bottom-right fullscreen ",e.embeded)),a(3),p(_("bottom-right appscreen ",e.embeded)),a(3),p(_("top-right mode-button ",e.embeded)),l("display",e.currentMode==="dark"?"flex":"none"),a(3),p(_("top-right mode-button ",e.embeded)),l("display",e.currentMode==="dark"?"none":"flex"),a(3),x("innerHTML",e.countdownTimer(),E),a(3),l("font-size",e.scaledFontSize,"px"),d("visible",e.showIcon().Right),a(2),l("font-size",e.scaledFontSize,"px"),d("visible",e.showIcon().Left),a(2),l("font-size",e.scaledFontSize,"px"),d("visible",e.showIcon().Up),a(2),l("font-size",e.scaledFontSize,"px"),d("visible",e.showIcon().Down),a(2),x("value",e.progressValue()))},dependencies:[K,J,$,Y,Z,ne,re],styles:[".conditional-visible.visible[_ngcontent-%COMP%]{display:block}.conditional-visible[_ngcontent-%COMP%]{display:none}.screen[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-surface);width:100vw;height:100vh;position:relative;box-sizing:border-box;overflow:hidden}.screen.embeded[_ngcontent-%COMP%]{border-radius:var(--mat-sys-corner-large);width:50vw;height:50vh}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.counter[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);font:var(--mat-sys-body-small);font-size:12vh}.fixation[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);z-index:9999}.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em}.bottom-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;bottom:16px}.top-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;top:16px}.top-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;top:16px}button.top-left[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], button.bottom-right[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:1em;height:1em}.stop[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.fullscreen[_ngcontent-%COMP%]{display:none}.appscreen[_ngcontent-%COMP%], .fullscreen.embeded[_ngcontent-%COMP%]{display:block}.appscreen.embeded[_ngcontent-%COMP%]{display:none}.mode-button.embeded[_ngcontent-%COMP%]{display:none!important}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}"]})};export{ie as a};
