import{c as O}from"./chunk-CJIUCN7P.js";import{a as E,b as P,c as k}from"./chunk-X26ILOSG.js";import{k as R}from"./chunk-NHZF5AWK.js";import{b as _,c as L}from"./chunk-P3ALKQJN.js";import{b as D}from"./chunk-ZSOYSSWO.js";import{Ab as b,Bb as l,Cb as c,Kb as C,Sa as a,Wb as S,Yb as x,Zb as I,db as g,hb as v,ra as f,ua as w,wb as T,yb as y,zb as M}from"./chunk-TEXVEQLC.js";import{h as p,i as h}from"./chunk-5KHZBZE7.js";function G(r,e){if(r&1&&(l(0,"mat-icon",2),x(1),c()),r&2){let t=e.$implicit,i=C();S("visible",i.showIcon()[t.class]),a(),I(t.value)}}var N=class r extends P{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];showIcon=f(Object.fromEntries(this.cues.map(e=>[e.class,!1])));fullWindowLink="/experiments/motor-imagery/unilateral/stimuli";normalWindowLink="/experiments/motor-imagery/unilateral";startCountdownValue=5;ngOnInit(){return h(this,null,function*(){p(r.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Unilateral Motor Imagery" CYAN 3;')})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let e=[];for(let t of this.experimentConfig.classes)for(let i=0;i<this.experimentConfig.trials_per_class;i++)e.push({class:t,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.showIcon.set(Object.fromEntries(this.cues.map(t=>[t.class,t.class===e])))}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let e=this.generateTrials(),t=performance.now(),i=0,s=[],m=()=>{s.forEach(n=>window.clearTimeout(n)),s=[]},u=()=>{if(i>=e.length){m(),this.onDelivery.set(!1);return}let n=e[i],B=t+e.slice(0,i).reduce((o,d)=>o+d.duration+d.soa,0),F=Math.max(0,B-performance.now()),A=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "${n.class}" GREEN;`),this.showTrial(n.class);let o=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),i++,this.setProgress(100*i/e.length),u()},n.duration);s.push(o)},F);s.push(A)};return u(),m}static \u0275fac=(()=>{let e;return function(i){return(e||(e=w(r)))(i||r)}})();static \u0275cmp=g({type:r,selectors:[["app-stimuli"]],features:[v],decls:3,vars:1,consts:[[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(t,i){t&1&&(l(0,"app-stimuli-layout",0),y(1,G,2,3,"mat-icon",1,T),c()),t&2&&(b("hostRef",i),a(),M(i.cues))},dependencies:[L,_,E,D,O,R,k],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto}"]})};export{N as a};
