import{c as B}from"./chunk-4PHGQJCB.js";import{a as k,b as u,c as A,d as F}from"./chunk-MWTCSHRF.js";import{k as N}from"./chunk-FNTTNCNS.js";import{b as R,c as D}from"./chunk-XRGWM46W.js";import{b as P}from"./chunk-EBVX5MXQ.js";import{Ab as I,Bb as c,Cb as m,Mb as L,Sa as l,Yb as E,_b as _,ac as O,db as T,hb as b,ra as w,tb as C,ua as y,wb as M,yb as S,zb as x}from"./chunk-JNWBK6C6.js";import{i as o,j as g,k as v}from"./chunk-GV7GV3NK.js";function j(p,e){if(p&1&&(c(0,"mat-icon",3,0),_(2),m()),p&2){let i=e.$implicit,t=L();E("visible",t.showIcon()[i.class]),C("cue-key",t.fixClass(i.class)),l(2),O("",i.value," ")}}var s=class s extends A{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];showIcon=w(Object.fromEntries(this.cues.map(e=>[e.class,!1])));fullWindowLink="/paradigms/motor-imagery/unilateral/stimuli";normalWindowLink="/paradigms/motor-imagery/unilateral";startCountdownValue=5;ngOnInit(){return v(this,null,function*(){g(s.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Unilateral Motor Imagery" BLUE 3;')})}generateTrials(){let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.propagateClassMarker(e),this.showIcon.set(Object.fromEntries(this.cues.map(i=>[i.class,i.class===e])))}setOpacity(e,i){let t=this.cuesElement.find(a=>a._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(e));t&&(t._elementRef.nativeElement.style.opacity=i.toString())}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,a=[],d=()=>{a.forEach(n=>window.clearTimeout(n)),a=[]},h=()=>{if(t>=e.length){d(),this.onDelivery.set(!1);return}let n=e[t],G=i+e.slice(0,t).reduce((r,f)=>r+f.duration+f.soa,0),q=Math.max(0,G-performance.now()),$=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial Start: ${n.class}" GREEN;`),this.showTrial(n.class);let r=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial End: ${n.class}" ORANGE;`),this.showTrial(null),t++,this.setProgress(100*t/e.length),h()},n.duration);a.push(r)},q);a.push($)};return h(),d}static \u0275fac=(()=>{let e;return function(t){return(e||(e=y(s)))(t||s)}})();static \u0275cmp=T({type:s,selectors:[["app-stimuli"]],features:[b],decls:3,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(c(0,"app-stimuli-layout",1),S(1,j,3,4,"mat-icon",2,M),m()),i&2&&(I("hostRef",t),l(),x(t.cues))},dependencies:[D,R,k,P,B,N,F],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto}"]})};o([u("TRIAL",{arguments:["CLASS"],example:"Trial Right",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],s.prototype,"showTrial",1),o([u("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Right 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],s.prototype,"setOpacity",1);var U=s;export{U as a};
