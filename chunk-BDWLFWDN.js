import{c as B}from"./chunk-4PHGQJCB.js";import{a as k,b as E,c as F,d as A}from"./chunk-OLUWFB5T.js";import{k as D}from"./chunk-FNTTNCNS.js";import{c as I}from"./chunk-XRGWM46W.js";import{b as O}from"./chunk-EBVX5MXQ.js";import{c as P}from"./chunk-KKFSZARV.js";import{Ab as x,Bb as h,Cb as g,Mb as R,Sa as l,Yb as d,_b as S,ac as L,db as b,hb as T,ra as w,ua as v,wb as _,yb as M,zb as y}from"./chunk-JNWBK6C6.js";import{i as p,j as f,k as C}from"./chunk-GV7GV3NK.js";function $(c,e){if(c&1&&(h(0,"div",4,0),S(2),g()),c&2){let r=e.$implicit,i=e.$index,t=R();d("embedded",t.embedded==="embedded")("highlightRow",t.getRow(i)===t.highlightedRow)("highlightCol",t.getCol(i)===t.highlightedCol)("highlightTargetRow",t.getRow(i)===t.highlightedTargetRow)("highlightTargetCol",t.getCol(i)===t.highlightedTargetCol),l(2),L(" ",r.value," ")}}var a=class a extends F{showIcon=w(Object.fromEntries(this.cues().map(e=>[e.class,!1])));fullWindowLink="/paradigms/p300/speller/stimuli";normalWindowLink="/paradigms/p300/speller";startCountdownValue=5;cols=6;highlightedRow=-1;highlightedCol=-1;highlightedTargetRow=-1;highlightedTargetCol=-1;ngOnInit(){return C(this,null,function*(){f(a.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE TEXT="P300 Speller" COLOR=BLUE SIZE=3;'),this.generateCues()})}generateCues(){this.cues.set(Object.keys(this.stimulusCommandMap).filter(e=>e.length===1).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]})).sort((e,r)=>{let i=m=>/^[A-Za-z]/.test(m),t=i(e.value),s=i(r.value);return t&&!s?-1:!t&&s?1:e.value.localeCompare(r.value)}))}generateTrials(){let e=[];for(let r=0;r<this.experimentConfig.target_characters;r++){let i=this.generateShuffledList(6),t=this.generateShuffledList(6),s=t[0]*this.cols+i[0],m=i[0],U=t[0];i=i.slice(1),t=t.slice(1),e.push({class:this.cues()[s]?.class+"-Feedback",duration:this.experimentConfig.target_duration,soa:this.experimentConfig.soa_inter_trial});let o=[],u=["c","r"],j=Math.floor(this.experimentConfig.target_probability*this.experimentConfig.repetitions_per_target/100);for(let n=0;n<j;n++)o.push({class:u[o.length%2]+this.cues()[s]?.class+"-Target",duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial});for(let n=o.length;n<this.experimentConfig.repetitions_per_target;n++){let z=t[n%5]*this.cols+i[n%5];o.push({class:u[o.length%2]+this.cues()[z]?.class+"-NonTarget",duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial})}o=this.shufflePreservingParity(o),o[o.length-1].soa=this.experimentConfig.soa_intra_trial,e.push(...o)}return e.flat()}showTrial(e){if(e===null){this.highlightedTargetRow=-1,this.highlightedTargetCol=-1,this.highlightedRow=-1,this.highlightedCol=-1;return}e.length===1&&(e=e+"-Feedback");let[r,i]=e.split("-");this.propagateClassMarker(i.trim());let t=this.cues().findIndex(s=>s.class===r[r.length-1]);r.startsWith("c")?(this.highlightedRow=-1,this.highlightedCol=this.getCol(t)):r.startsWith("r")?(this.highlightedRow=this.getRow(t),this.highlightedCol=-1):(this.highlightedTargetRow=this.getRow(t),this.highlightedTargetCol=this.getCol(t))}stopStimuliSequence(){this.showTrial(null)}getRow(e){return Math.floor(e/this.cols)}getCol(e){return e%this.cols}static \u0275fac=(()=>{let e;return function(i){return(e||(e=v(a)))(i||a)}})();static \u0275cmp=b({type:a,selectors:[["app-stimuli"]],features:[T],decls:4,vars:3,consts:[["cueElement",""],[3,"hostRef"],[1,"grid-list","grid-responsive-6"],[1,"cue","conditional-visible",3,"embedded","highlightRow","highlightCol","highlightTargetRow","highlightTargetCol"],[1,"cue","conditional-visible"]],template:function(r,i){r&1&&(h(0,"app-stimuli-layout",1)(1,"div",2),M(2,$,3,11,"div",3,_),g()()),r&2&&(x("hostRef",i),l(),d("embedded",i.embedded==="embedded"),l(),y(i.cues()))},dependencies:[I,k,O,B,D,A,P],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-size:5vh;opacity:.3;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.cue.embedded[_ngcontent-%COMP%]{font-size:3vh}.highlightRow[_ngcontent-%COMP%], .highlightCol[_ngcontent-%COMP%]{color:var(--mat-sys-on-primary);opacity:1;background-color:var(--mat-sys-on-surface-variant)}.highlightTargetRow.highlightTargetCol[_ngcontent-%COMP%]{color:red;opacity:1;transform:scale(1.5)}.grid-list[_ngcontent-%COMP%]{position:unset;height:80vh;width:80vh;margin:auto;gap:0}.grid-list.embedded[_ngcontent-%COMP%]{height:80%;width:80%;margin-top:5%}"]})};p([E("TRIAL",{arguments:["CLASS"],example:"Trial Target",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],a.prototype,"showTrial",1);var W=a;export{W as a};
