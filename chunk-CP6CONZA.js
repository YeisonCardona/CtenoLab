import{a as N,b as W,c as $}from"./chunk-Z3HDPPOP.js";import{a as V,b as U,c as J,d as K}from"./chunk-XYZA5YVS.js";import{a as j}from"./chunk-OKGPLXOB.js";import{b as G}from"./chunk-QI6BQY7F.js";import{a as q,b as Y}from"./chunk-OE4JWPVS.js";import{b as A,c as z}from"./chunk-TPLGXWRQ.js";import{a as x,c as E,d as B}from"./chunk-Q2YUHGYH.js";import{j as D}from"./chunk-EKJQ62GW.js";import{$a as p,$b as m,Ab as T,Cb as O,Db as I,Eb as f,Fb as i,Gb as a,Hb as v,Nb as c,Ob as F,Ta as P,Wa as r,Zb as b,_b as h,ac as s,c as y,cc as R,d as C,hb as L,jc as H,kc as d,lb as k,va as S}from"./chunk-WCTXA5YZ.js";function te(l,t){if(l&1&&(i(0,"mat-grid-tile")(1,"mat-icon",11),s(2),a()()),l&2){let n=t.$implicit,e=t.$index,o=F();r(),h("visible",o.showIcon()[n.class])("mirror",e===0||e===3),r(),R("",n.value," ")}}var Q=class l extends J{cues=[{class:"Left Hand",value:"back_hand"},{class:"Right Hand",value:"back_hand"},{class:"Left Foot",value:"barefoot"},{class:"Right Foot",value:"barefoot"}];showIcon=S(Object.fromEntries(this.cues.map(t=>[t.class,!1])));fullWindowLink="/experiments/motor-imagery/bilateral/stimuli";normalWindowLink="/experiments/motor-imagery/bilateral";startCountdownValue=5;constructor(t,n,e,o){super(t,n,e,o)}ngOnInit(){return C(this,null,function*(){y(l.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Bilateral Motor Imagery" CYAN 3;')})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let t=[];for(let n of this.experimentConfig.classes)for(let e=0;e<this.experimentConfig.trials_per_class;e++)t.push({class:n,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return t=this.shuffle(t),t}showTrial(t){switch(t){case"Left Hand":this.showIcon.set({"Left Hand":!0,"Right Hand":!1,"Left Foot":!1,"Right Foot":!1});break;case"Right Hand":this.showIcon.set({"Left Hand":!1,"Right Hand":!0,"Left Foot":!1,"Right Foot":!1});break;case"Both Hands":this.showIcon.set({"Left Hand":!0,"Right Hand":!0,"Left Foot":!1,"Right Foot":!1});break;case"Left Hand + Right Foot":this.showIcon.set({"Left Hand":!0,"Right Hand":!1,"Left Foot":!1,"Right Foot":!0});break;case"Right Hand + Left Foot":this.showIcon.set({"Left Hand":!1,"Right Hand":!0,"Left Foot":!0,"Right Foot":!1});break;case"Rest":this.showIcon.set({"Left Hand":!1,"Right Hand":!1,"Left Foot":!1,"Right Foot":!1});break;case null:this.showIcon.set({"Left Hand":!1,"Right Hand":!1,"Left Foot":!1,"Right Foot":!1});break}}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let t=this.generateTrials(),n=performance.now(),e=0,o=[],_=()=>{o.forEach(u=>window.clearTimeout(u)),o=[]},M=()=>{if(e>=t.length){_(),this.onDelivery.set(!1);return}let u=t[e],X=n+t.slice(0,e).reduce((g,w)=>g+w.duration+w.soa,0),Z=Math.max(0,X-performance.now()),ee=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "${u.class}" BLUE;`),this.showTrial(u.class);let g=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),e++,this.setProgress(100*e/t.length),M()},u.duration);o.push(g)},Z);o.push(ee)};return M(),_}static \u0275fac=function(n){return new(n||l)(p(x),p(j),p(E),p(G))};static \u0275cmp=L({type:l,selectors:[["app-stimuli"]],features:[k],decls:27,vars:27,consts:[["matIconButton","","matTooltip","\u26A0\uFE0F Stop stimulus delivery",1,"stop","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Starting will begin stimulus delivery",1,"start","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Fullscreen will restart stimulus delivery",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Exiting fullscreen will restart stimulus delivery",3,"routerLink"],["matIconButton","","id","mode-light",3,"click"],["matIconButton","","id","mode-dark",3,"click"],[1,"bottom-left"],[1,"center","counter",3,"innerHTML"],[1,"center","fixation"],["cols","2","rowHeight","50%",1,"center"],["mode","determinate",3,"value"],[1,"cue","conditional-visible"]],template:function(n,e){n&1&&(i(0,"div")(1,"button",0),c("click",function(){return e.stopSequence()}),i(2,"mat-icon"),s(3,"stop_circle"),a()(),i(4,"button",1),c("click",function(){return e.startCountdown()}),i(5,"mat-icon"),s(6,"play_circle"),a()(),i(7,"button",2),c("click",function(){return e.gotoFullWindow()}),i(8,"mat-icon"),s(9,"arrows_output"),a()(),i(10,"button",3)(11,"mat-icon"),s(12,"fullscreen_exit"),a()(),i(13,"button",4),c("click",function(){return e.setReactiveMode("light")}),i(14,"mat-icon"),s(15,"light_mode"),a()(),i(16,"button",5),c("click",function(){return e.setReactiveMode("dark")}),i(17,"mat-icon"),s(18,"dark_mode"),a()(),v(19,"app-hardware",6)(20,"span",7),i(21,"mat-icon",8),s(22,"point_scan"),a(),i(23,"mat-grid-list",9),O(24,te,3,5,"mat-grid-tile",null,T),a(),v(26,"mat-progress-bar",10),a()),n&2&&(m(d("screen ",e.embeded)),r(),h("visible-b",e.onDelivery()),r(3),h("visible-b",!e.onDelivery()),r(3),m(d("bottom-right fullscreen ",e.embeded)),r(3),m(d("bottom-right appscreen ",e.embeded)),f("routerLink",H(e.normalWindowLink)),r(3),m(d("top-right mode-button ",e.embeded)),b("display",e.currentMode==="dark"?"flex":"none"),r(3),m(d("top-right mode-button ",e.embeded)),b("display",e.currentMode==="dark"?"none":"flex"),r(4),f("innerHTML",e.countdownTimer(),P),r(4),I(e.cues),r(2),f("value",e.progressValue()))},dependencies:[z,A,D,U,V,B,K,Y,q,$,W,N],styles:[".start[_ngcontent-%COMP%], .stop[_ngcontent-%COMP%]{scale:2}.conditional-visible-b.visible-b[_ngcontent-%COMP%]{visibility:visible}.conditional-visible-b[_ngcontent-%COMP%]{visibility:hidden}.screen[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-surface);width:100vw;height:100vh;position:relative;box-sizing:border-box;overflow:hidden}.screen.embeded[_ngcontent-%COMP%]{border-radius:var(--mat-sys-corner-large);width:100%;height:50vh;margin:0 auto}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.counter[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);font:var(--mat-sys-body-small);font-size:12vh}.fixation[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);z-index:9999}.bottom-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;bottom:16px}.bottom-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;bottom:16px}.top-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;top:16px}.top-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;top:16px}button.top-left[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], button.bottom-right[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:1em;height:1em}.stop[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.fullscreen[_ngcontent-%COMP%]{display:none}.appscreen[_ngcontent-%COMP%], .fullscreen.embeded[_ngcontent-%COMP%]{display:block}.appscreen.embeded[_ngcontent-%COMP%]{display:none}.mode-button.embeded[_ngcontent-%COMP%]{display:none!important}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}button[_ngcontent-%COMP%]{z-index:1000}",".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:20vh}mat-grid-list[_ngcontent-%COMP%]{width:70vh;height:70vh}.conditional-visible[_ngcontent-%COMP%]{visibility:visible;opacity:.3;transform:scale(1);transition:opacity .3s ease,transform .3s ease}.conditional-visible.mirror[_ngcontent-%COMP%]{transform:scale(1) rotateY(180deg)}.conditional-visible.visible[_ngcontent-%COMP%]{visibility:visible;opacity:1;transform:scale(1.2)}.conditional-visible.visible.mirror[_ngcontent-%COMP%]{transform:scale(1.2) rotateY(180deg)}"]})};export{Q as a};
