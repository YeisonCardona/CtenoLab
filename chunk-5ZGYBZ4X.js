import{c as A}from"./chunk-4PHGQJCB.js";import{a as B,b as D,c as E,d as W}from"./chunk-6TBHGCTQ.js";import{k as F}from"./chunk-FNTTNCNS.js";import{c as P}from"./chunk-XRGWM46W.js";import{b as k}from"./chunk-EBVX5MXQ.js";import{c as O}from"./chunk-KKFSZARV.js";import{Ab as _,Bb as g,Cb as d,Mb as S,Sa as a,Yb as c,_b as L,ac as I,db as b,hb as x,ra as v,ua as T,wb as y,yb as M,zb as R}from"./chunk-JNWBK6C6.js";import{i as f,j as C,k as w}from"./chunk-GV7GV3NK.js";function z(u,e){if(u&1&&(g(0,"div",4,0),L(2),d()),u&2){let o=e.$implicit,t=e.$index,i=S();c("embedded",i.embedded==="embedded")("highlightRow",i.getRow(t)===i.highlightedRow)("highlightCol",i.getCol(t)===i.highlightedCol)("highlightTargetRow",i.getRow(t)===i.highlightedTargetRow)("highlightTargetCol",i.getCol(t)===i.highlightedTargetCol),a(2),I(" ",o.value," ")}}var n=class n extends E{showIcon=v(Object.fromEntries(this.cues().map(e=>[e.class,!1])));fullWindowLink="/paradigms/p300/speller/stimuli";normalWindowLink="/paradigms/p300/speller";startCountdownValue=5;cols=6;highlightedRow=-1;highlightedCol=-1;highlightedTargetRow=-1;highlightedTargetCol=-1;ngOnInit(){return w(this,null,function*(){C(n.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "P300 Speller" BLUE 3;'),this.generateCues()})}generateCues(){this.cues.set(Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]})).sort((e,o)=>{let t=m=>/^[A-Za-z]/.test(m),i=t(e.value),s=t(o.value);return i&&!s?-1:!i&&s?1:e.value.localeCompare(o.value)}))}generateTrials(){let e=[];for(let o=0;o<this.experimentConfig.total_trials;o++){let t=this.generateShuffledList(6),i=this.generateShuffledList(6),s=i[0]*this.cols+t[0],m=t[0],$=i[0];t=t.slice(1),i=i.slice(1),e.push({class:this.cues()[s]?.class,duration:this.experimentConfig.target_duration,soa:this.experimentConfig.soa_inter_trial});let r=[],p=["c","r"];for(let l=0;l<this.experimentConfig.target;l++)r.push({class:p[r.length%2]+this.cues()[s]?.class,duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial});let h=r.length;for(;r.length<this.experimentConfig.non_target+this.experimentConfig.target;){let l=i[h%5]*this.cols+t[h%5];r.push({class:p[r.length%2]+this.cues()[l]?.class,duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial}),h++}r=this.shufflePreservingParity(r),r[r.length-1].soa=this.experimentConfig.soa_intra_trial,e.push(...r)}return console.log("TRIALS",e),e.flat()}showTrial(e){if(e===null){this.highlightedTargetRow=-1,this.highlightedTargetCol=-1,this.highlightedRow=-1,this.highlightedCol=-1;return}console.log("TC",e);let o=this.cues().findIndex(t=>t.class===e[e.length-1]);e.startsWith("c")?(this.highlightedRow=-1,this.highlightedCol=this.getCol(o)):e.startsWith("r")?(this.highlightedRow=this.getRow(o),this.highlightedCol=-1):(this.highlightedTargetRow=this.getRow(o),this.highlightedTargetCol=this.getCol(o))}stopStimuliSequence(){this.showTrial(null)}getRow(e){return Math.floor(e/this.cols)}getCol(e){return e%this.cols}static \u0275fac=(()=>{let e;return function(t){return(e||(e=T(n)))(t||n)}})();static \u0275cmp=b({type:n,selectors:[["app-stimuli"]],features:[x],decls:4,vars:3,consts:[["cueElement",""],[3,"hostRef"],[1,"grid-list","grid-responsive-6"],[1,"cue","conditional-visible",3,"embedded","highlightRow","highlightCol","highlightTargetRow","highlightTargetCol"],[1,"cue","conditional-visible"]],template:function(o,t){o&1&&(g(0,"app-stimuli-layout",1)(1,"div",2),M(2,z,3,11,"div",3,y),d()()),o&2&&(_("hostRef",t),a(),c("embedded",t.embedded==="embedded"),a(),R(t.cues()))},dependencies:[P,B,k,A,F,W,O],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-size:5vh;opacity:.3;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.cue.embedded[_ngcontent-%COMP%]{font-size:3vh}.highlightRow[_ngcontent-%COMP%], .highlightCol[_ngcontent-%COMP%]{color:var(--mat-sys-on-primary);opacity:1;background-color:var(--mat-sys-on-surface-variant)}.highlightTargetRow.highlightTargetCol[_ngcontent-%COMP%]{color:red;opacity:1;transform:scale(1.5)}.grid-list[_ngcontent-%COMP%]{position:unset;height:80vh;width:80vh;margin:auto;gap:0}.grid-list.embedded[_ngcontent-%COMP%]{height:80%;width:80%;margin-top:5%}"]})};f([D("TRIAL",{arguments:["CLASS"],example:"Trial Target",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],n.prototype,"showTrial",1);var j=n;export{j as a};
