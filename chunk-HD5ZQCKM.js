import{a as E}from"./chunk-SMN6YHFH.js";import"./chunk-VEDDZ7KK.js";import"./chunk-HRYCUA6K.js";import{a as T,b as M}from"./chunk-J7R32EXU.js";import{e as F}from"./chunk-T6JZKSF2.js";import{c as x}from"./chunk-BN5QOK7L.js";import{l as k,o as S}from"./chunk-EXEM6OM4.js";import{ca as R}from"./chunk-RWQLXEFD.js";import{Bb as r,Cb as n,Db as l,Fb as v,Jb as C,Kb as d,Sa as c,Xa as b,Yb as o,Z as p,_b as u,db as g,eb as w,ga as _,ha as y,ub as h,vb as m}from"./chunk-FHWKK7EC.js";import{i as D}from"./chunk-5KHZBZE7.js";var I=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=w({type:t});static \u0275inj=p({imports:[F]})}return t})();var N=(()=>{class t{static \u0275fac=function(i){return new(i||t)};static \u0275mod=w({type:t});static \u0275inj=p({imports:[R,I,R]})}return t})();function q(t,s){if(t&1){let e=v();r(0,"h1"),o(1,"Welcome, Researcher"),n(),r(2,"p"),o(3,"Please sign in with your preferred method."),n(),r(4,"div",1)(5,"button",2),C("click",function(){_(e);let a=d();return y(a.supabaseService.signInWithProvider("google"))}),l(6,"i",3),o(7," Log in using Google "),n(),r(8,"button",2),C("click",function(){_(e);let a=d();return y(a.supabaseService.signInWithProvider("github"))}),l(9,"i",4),o(10," Log in using GitHub "),n()()}}function K(t,s){if(t&1&&(r(0,"p")(1,"b"),o(2,"License Tier:"),n(),o(3),l(4,"br"),r(5,"b"),o(6,"Issued at:"),n(),o(7),l(8,"br"),r(9,"b"),o(10,"Expires at:"),n(),o(11),l(12,"br"),r(13,"b"),o(14,"Remaining days:"),n(),o(15),l(16,"br"),n()),t&2){let e,i,a,f=d(2);c(3),u(" ",(e=f.supabaseService.userLicense())==null?null:e.tier),c(4),u(" ",(i=f.supabaseService.userLicense())==null?null:i.issued_at),c(4),u(" ",(a=f.supabaseService.userLicense())==null?null:a.expires_at),c(4),u(" ",f.getRemainingDays())}}function Y(t,s){t&1&&(r(0,"p"),o(1," Your account does not have an active license."),l(2,"br"),o(3," Please redeem or purchase a license to unlock full access. "),n())}function G(t,s){if(t&1){let e=v();r(0,"h1"),o(1),n(),r(2,"p"),o(3,"You are now signed in to your researcher dashboard."),n(),r(4,"div",5)(5,"button",6),C("click",function(){_(e);let a=d();return y(a.supabaseService.signOut())}),o(6,"Sign out"),n()(),l(7,"mat-divider"),h(8,K,17,4,"p")(9,Y,4,0,"p")}if(t&2){let e=d();c(),u("Welcome back, ",e.supabaseService.userMail(),"!"),c(7),m(e.supabaseService.licenseActive()?8:9)}}var A=class t{constructor(s){this.supabaseService=s}amount=10;getRemainingDays(){let s=this.supabaseService.userLicense()?.expires_at,e=new Date,a=new Date(s).getTime()-e.getTime(),f=Math.ceil(a/(1e3*60*60*24));return f>=0?f:0}ngAfterViewInit(){return D(this,null,function*(){let s=yield this.supabaseService.getUser();return s&&this.loadPayPalScript().then(()=>{paypal.Buttons({createOrder:(e,i)=>i.order.create({purchase_units:[{amount:{value:this.amount},custom_id:s.id,invoice_id:"Pro"}]}),onApprove:(e,i)=>D(this,null,function*(){let a=yield i.order.capture();alert(`\u2705 Payment completed by ${a.payer.name.given_name}`)})}).render("#paypal-button-container")}),null})}loadPayPalScript(){return new Promise((s,e)=>{if(document.getElementById("paypal-sdk"))return s();let i=document.createElement("script");i.id="paypal-sdk",i.src="https://www.sandbox.paypal.com/sdk/js?client-id=AUnhdkc5RMBKvvp4kHbHTMuXbYyzrtbBRydYGYRjlsSbga6vUhzYyqSnVwaKTCPYgGDSvvZBKGJXCNvh&currency=USD",i.onload=()=>s(),i.onerror=()=>e("Failed to load PayPal SDK"),document.body.appendChild(i)})}static \u0275fac=function(e){return new(e||t)(b(E))};static \u0275cmp=g({type:t,selectors:[["app-user"]],decls:3,vars:1,consts:[["id","paypal-button-container"],[1,"flex-row"],["matButton","filled",1,"logbutton",3,"click"],[1,"devicon","devicon-google-plain"],[1,"devicon","devicon-github-original"],[1,"flex-row","margin-bottom-large"],["matButton","filled",1,"error",3,"click"]],template:function(e,i){e&1&&(h(0,q,11,0)(1,G,10,2),l(2,"div",0)),e&2&&m(i.supabaseService.userLogged()?1:0)},dependencies:[x,M,T,S,k,N],encapsulation:2})};export{A as User};
