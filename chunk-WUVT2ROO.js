import{a as _,b as p,c as k,d as A}from"./chunk-JJQ4RR7G.js";import{c as D}from"./chunk-XRGWM46W.js";import{b as P}from"./chunk-EBVX5MXQ.js";import{$b as R,Ab as E,Bb as c,Cb as m,Mb as O,Sa as l,Yb as L,_b as u,db as T,hb as b,ra as w,tb as x,ua as C,wb as S,yb as M,zb as I}from"./chunk-JNWBK6C6.js";import{i as o,j as v,k as y}from"./chunk-GV7GV3NK.js";function U(d,e){if(d&1&&(c(0,"span",3,0),u(2),m()),d&2){let i=e.$implicit,t=O();L("visible",t.showIcon()[i.class]),x("cue-key",t.fixClass(i.class)),l(2),R(i.value)}}var s=class s extends k{cues=[];showIcon=w(Object.fromEntries(this.cues.map(e=>[e.class,!1])));fullWindowLink="/paradigms/motor-imagery/wordcued/stimuli";normalWindowLink="/paradigms/motor-imagery/wordcued";startCountdownValue=5;ngOnInit(){return y(this,null,function*(){v(s.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Word-Cued Motor Imagery" BLUE 3;'),this.cues=Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]}))})}generateTrials(){let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.propagateClassMarker(e),this.showIcon.set(Object.fromEntries(this.cues.map(i=>[i.class,i.class===e])))}setOpacity(e,i){let t=this.cuesElement.find(n=>n._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(e));t&&(t._elementRef.nativeElement.style.opacity=i.toString())}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,n=[],h=()=>{n.forEach(a=>window.clearTimeout(a)),n=[]},f=()=>{if(t>=e.length){h(),this.onDelivery.set(!1);return}let a=e[t],F=i+e.slice(0,t).reduce((r,g)=>r+g.duration+g.soa,0),G=Math.max(0,F-performance.now()),N=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial Start: ${a.class}" GREEN;`),this.showTrial(a.class);let r=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial End: ${a.class}" ORANGE;`),this.showTrial(null),t++,this.setProgress(100*t/e.length),f()},a.duration);n.push(r)},G);n.push(N)};return f(),h}static \u0275fac=(()=>{let e;return function(t){return(e||(e=C(s)))(t||s)}})();static \u0275cmp=T({type:s,selectors:[["app-stimuli"]],features:[b],decls:4,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(c(0,"app-stimuli-layout",1),u(1," WORDCUED "),M(2,U,3,4,"span",2,S),m()),i&2&&(E("hostRef",t),l(2),I(t.cues))},dependencies:[D,_,P,A],styles:['.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-size:10vh;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}']})};o([p("TRIAL",{arguments:["CLASS"],example:"Trial Right",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],s.prototype,"showTrial",1),o([p("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Right 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],s.prototype,"setOpacity",1);var B=s;export{B as a};
