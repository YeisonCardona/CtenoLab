import{a as E,b as D,c as k}from"./chunk-7SFZJKQS.js";import{c as O}from"./chunk-RMWCCIY2.js";import{b as L}from"./chunk-CZTA7AJK.js";import{$b as C,Ab as _,Bb as l,Cb as c,Mb as g,Sa as r,Yb as w,_b as v,db as M,hb as S,ra as p,ua as x,wb as h,yb as d,zb as f}from"./chunk-HXPFIK5A.js";import{h as T,i as I}from"./chunk-5KHZBZE7.js";function G(n,e){if(n&1&&(l(0,"span",3),v(1),c()),n&2){let i=e.$implicit,t=g();w("intentional",t.showIcon()[i.class]),r(),C(i.value)}}function $(n,e){if(n&1&&(l(0,"span",3),v(1),c()),n&2){let i=e.$implicit,t=g();w("visible",t.showIntentionalIcon()[i.class]),r(),C(i.value)}}var P=class n extends D{cues=[];intentionalCues=[];showIcon=p(Object.fromEntries(this.cues.map(e=>[e.class,!1])));showIntentionalIcon=p(Object.fromEntries(this.intentionalCues.map(e=>[e.class,!1])));fullWindowLink="/experiments/motor-imagery/sequential/stimuli";normalWindowLink="/experiments/motor-imagery/sequential";startCountdownValue=5;ngOnInit(){return I(this,null,function*(){T(n.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Sequential Motor Imagery" CYAN 3;'),this.cues=Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]})),this.intentionalCues=Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]}))})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){let i;e!==null?i=e.split("->").map(s=>s.trim())[0]:i=null,this.showIcon.set(Object.fromEntries(this.cues.map(t=>[t.class,t.class===i])))}showIntentionalTrial(e){let i;e!==null?i=e.split("->").map(s=>s.trim())[1]:i=null,this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(t=>[t.class,t.class===i])))}stopStimuliSequence(){this.showTrial(null),this.showIntentionalTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,s=[],y=()=>{s.forEach(o=>window.clearTimeout(o)),s=[]},b=()=>{if(t>=e.length){y(),this.onDelivery.set(!1);return}let o=e[t],j=i+e.slice(0,t).reduce((m,a)=>m+a.duration+a.duration+a.soa,0),q=Math.max(0,j-performance.now()),F=window.setTimeout(()=>{let m=o.class.split("->").map(u=>u.trim());this.hardwareService.writeLine(`CMD=@LOG "intention: ${m[0]}" YELLOW;`),this.showIntentionalTrial(o.class);let a=window.setTimeout(()=>{let u=o.class.split("->").map(R=>R.trim());this.hardwareService.writeLine(`CMD=@LOG "imagery: ${u[1]}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(o.class);let B=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),console.log("end"),t++,this.setProgress(100*t/e.length),b()},o.duration);s.push(B)},o.duration);s.push(a)},q);s.push(F)};return b(),y}static \u0275fac=(()=>{let e;return function(t){return(e||(e=x(n)))(t||n)}})();static \u0275cmp=M({type:n,selectors:[["app-stimuli"]],features:[S],decls:5,vars:1,consts:[[3,"hostRef"],[1,"center","cue","conditional-visible",3,"intentional"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(l(0,"app-stimuli-layout",0),d(1,G,2,3,"span",1,h),d(3,$,2,3,"span",2,h),c()),i&2&&(_("hostRef",t),r(),f(t.cues),r(2),f(t.intentionalCues))},dependencies:[O,E,L,k],styles:['.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em;font-size:10vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.intentional[_ngcontent-%COMP%], .conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}']})};export{P as a};
