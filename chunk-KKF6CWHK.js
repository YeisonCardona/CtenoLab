import{c as E}from"./chunk-4PHGQJCB.js";import{a as k,b as B,c as D,d as A}from"./chunk-X72VHBRK.js";import{k as F}from"./chunk-FNTTNCNS.js";import{c as P}from"./chunk-XRGWM46W.js";import{b as O}from"./chunk-EBVX5MXQ.js";import{c as I}from"./chunk-KKFSZARV.js";import{Ab as x,Bb as h,Cb as g,Mb as R,Sa as a,Yb as d,_b as S,ac as L,db as b,hb as T,ra as w,ua as v,wb as _,yb as M,zb as y}from"./chunk-JNWBK6C6.js";import{i as p,j as f,k as C}from"./chunk-GV7GV3NK.js";function $(c,e){if(c&1&&(h(0,"div",4,0),S(2),g()),c&2){let r=e.$implicit,t=e.$index,i=R();d("embedded",i.embedded==="embedded")("highlightRow",i.getRow(t)===i.highlightedRow)("highlightCol",i.getCol(t)===i.highlightedCol)("highlightTargetRow",i.getRow(t)===i.highlightedTargetRow)("highlightTargetCol",i.getCol(t)===i.highlightedTargetCol),a(2),L(" ",r.value," ")}}var n=class n extends D{showIcon=w(Object.fromEntries(this.cues().map(e=>[e.class,!1])));fullWindowLink="/paradigms/p300/speller/stimuli";normalWindowLink="/paradigms/p300/speller";startCountdownValue=5;cols=6;highlightedRow=-1;highlightedCol=-1;highlightedTargetRow=-1;highlightedTargetCol=-1;ngOnInit(){return C(this,null,function*(){f(n.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "P300 Speller" BLUE 3;'),this.generateCues()})}generateCues(){this.cues.set(Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]})).sort((e,r)=>{let t=u=>/^[A-Za-z]/.test(u),i=t(e.value),l=t(r.value);return i&&!l?-1:!i&&l?1:e.value.localeCompare(r.value)}))}generateTrials(){let e=[];for(let r=0;r<this.experimentConfig.target_characters;r++){let t=this.generateShuffledList(6),i=this.generateShuffledList(6),l=i[0]*this.cols+t[0],u=t[0],U=i[0];t=t.slice(1),i=i.slice(1),e.push({class:this.cues()[l]?.class,duration:this.experimentConfig.target_duration,soa:this.experimentConfig.soa_inter_trial});let o=[],m=["c","r"],j=Math.floor(this.experimentConfig.target_probability*this.experimentConfig.repetitions_per_target/100);for(let s=0;s<j;s++)o.push({class:m[o.length%2]+this.cues()[l]?.class,duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial});for(let s=o.length;s<this.experimentConfig.repetitions_per_target;s++){let z=i[s%5]*this.cols+t[s%5];o.push({class:m[o.length%2]+this.cues()[z]?.class,duration:this.experimentConfig.flash_duration,soa:this.experimentConfig.soa_inter_trial})}o=this.shufflePreservingParity(o),o[o.length-1].soa=this.experimentConfig.soa_intra_trial,e.push(...o)}return e.flat()}showTrial(e){if(e===null){this.highlightedTargetRow=-1,this.highlightedTargetCol=-1,this.highlightedRow=-1,this.highlightedCol=-1;return}this.propagateClassMarker(e[e.length-1]);let r=this.cues().findIndex(t=>t.class===e[e.length-1]);e.startsWith("c")?(this.highlightedRow=-1,this.highlightedCol=this.getCol(r)):e.startsWith("r")?(this.highlightedRow=this.getRow(r),this.highlightedCol=-1):(this.highlightedTargetRow=this.getRow(r),this.highlightedTargetCol=this.getCol(r))}stopStimuliSequence(){this.showTrial(null)}getRow(e){return Math.floor(e/this.cols)}getCol(e){return e%this.cols}static \u0275fac=(()=>{let e;return function(t){return(e||(e=v(n)))(t||n)}})();static \u0275cmp=b({type:n,selectors:[["app-stimuli"]],features:[T],decls:4,vars:3,consts:[["cueElement",""],[3,"hostRef"],[1,"grid-list","grid-responsive-6"],[1,"cue","conditional-visible",3,"embedded","highlightRow","highlightCol","highlightTargetRow","highlightTargetCol"],[1,"cue","conditional-visible"]],template:function(r,t){r&1&&(h(0,"app-stimuli-layout",1)(1,"div",2),M(2,$,3,11,"div",3,_),g()()),r&2&&(x("hostRef",t),a(),d("embedded",t.embedded==="embedded"),a(),y(t.cues()))},dependencies:[P,k,O,E,F,A,I],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-size:5vh;opacity:.3;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.cue.embedded[_ngcontent-%COMP%]{font-size:3vh}.highlightRow[_ngcontent-%COMP%], .highlightCol[_ngcontent-%COMP%]{color:var(--mat-sys-on-primary);opacity:1;background-color:var(--mat-sys-on-surface-variant)}.highlightTargetRow.highlightTargetCol[_ngcontent-%COMP%]{color:red;opacity:1;transform:scale(1.5)}.grid-list[_ngcontent-%COMP%]{position:unset;height:80vh;width:80vh;margin:auto;gap:0}.grid-list.embedded[_ngcontent-%COMP%]{height:80%;width:80%;margin-top:5%}"]})};p([B("TRIAL",{arguments:["CLASS"],example:"Trial Target",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],n.prototype,"showTrial",1);var W=n;export{W as a};
