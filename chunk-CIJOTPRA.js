import{a as L,b as k,c as D}from"./chunk-AK54JFFL.js";import{b as I,c as T}from"./chunk-SDG2FXYZ.js";import{b as S}from"./chunk-PT4O7Y4Y.js";import{Ab as M,Bb as m,Cb as d,Kb as y,Sa as u,Wb as O,Yb as x,Zb as P,db as v,hb as f,ra as c,ua as b,wb as w,yb as C,zb as _}from"./chunk-TEXVEQLC.js";import{h as g,i as h}from"./chunk-5KHZBZE7.js";function F(s,t){if(s&1&&(m(0,"mat-icon",2),x(1),d()),s&2){let e=t.$implicit,n=t.$index,i=y(),r=i.intentionalCues[n];O("visible",i.showIcon()[e.class])("intentional",i.showIntentionalIcon()[r.class]),u(),P(e.value)}}var E=class s extends k{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];intentionalCues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];showIcon=c(Object.fromEntries(this.cues.map(t=>[t.class,!1])));showIntentionalIcon=c(Object.fromEntries(this.intentionalCues.map(t=>[t.class,!1])));fullWindowLink="/experiments/motor-imagery/intentional/stimuli";normalWindowLink="/experiments/motor-imagery/intentional";startCountdownValue=5;ngOnInit(){return h(this,null,function*(){g(s.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Intentional Motor Imagery" CYAN 3;')})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let t=[];for(let e of this.experimentConfig.classes)for(let n=0;n<this.experimentConfig.trials_per_class;n++)t.push({class:e,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return t=this.shuffle(t),t}showTrial(t){this.showIcon.set(Object.fromEntries(this.cues.map(e=>[e.class,e.class===t])))}showIntentionalTrial(t){this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(e=>[e.class,e.class===t])))}stopStimuliSequence(){this.showTrial(null),this.showIntentionalTrial(null)}runStimuliSequence(){let t=this.generateTrials(),e=performance.now(),n=0,i=[],r=()=>{i.forEach(o=>window.clearTimeout(o)),i=[]},p=()=>{if(n>=t.length){r(),this.onDelivery.set(!1);return}let o=t[n],R=e+t.slice(0,n).reduce((l,a)=>l+a.duration+a.intentional_duration+a.soa,0),z=Math.max(0,R-performance.now()),N=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "intention: ${o.class}" YELLOW;`),this.showIntentionalTrial(o.class),console.log("intentional");let l=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "imagery: ${o.class}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(o.class),console.log("trial");let a=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),console.log("end"),n++,this.setProgress(100*n/t.length),p()},o.duration);i.push(a)},o.intentional_duration);i.push(l)},z);i.push(N)};return p(),r}static \u0275fac=(()=>{let t;return function(n){return(t||(t=b(s)))(n||s)}})();static \u0275cmp=v({type:s,selectors:[["app-stimuli"]],features:[f],decls:3,vars:1,consts:[[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible","intentional"],[1,"center","cue","conditional-visible"]],template:function(e,n){e&1&&(m(0,"app-stimuli-layout",0),C(1,F,2,5,"mat-icon",1,w),d()),e&2&&(M("hostRef",n),u(),_(n.cues))},dependencies:[T,I,L,S,D],styles:[":root .light{--mat-button-toggle-text-color: #e3e2e6;--mat-button-toggle-background-color: transparent;--mat-button-toggle-selected-state-text-color: #dbe2f9;--mat-button-toggle-selected-state-background-color: #3f4759}  :root .dark{--mat-button-toggle-text-color: #1b1b1f;--mat-button-toggle-background-color: transparent;--mat-button-toggle-selected-state-text-color: #131b2c;--mat-button-toggle-selected-state-background-color: #dbe2f9}.start[_ngcontent-%COMP%], .stop[_ngcontent-%COMP%]{scale:2}.conditional-visible-b.visible-b[_ngcontent-%COMP%]{visibility:visible}.conditional-visible-b[_ngcontent-%COMP%]{visibility:hidden}.screen[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-surface);width:100vw;height:100vh;position:relative;box-sizing:border-box;overflow:hidden}.screen.embeded[_ngcontent-%COMP%]{border-radius:var(--mat-sys-corner-large);width:100%;height:50vh;margin:0 auto}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.counter[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);font:var(--mat-sys-body-small);font-size:12vh}.fixation[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);z-index:9999}.bottom-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;bottom:16px}.bottom-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;bottom:16px}.top-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;top:16px}.top-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;top:16px}button.top-left[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], button.bottom-right[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:1em;height:1em}.stop[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.fullscreen[_ngcontent-%COMP%]{display:none}.appscreen[_ngcontent-%COMP%], .fullscreen.embeded[_ngcontent-%COMP%]{display:block}.appscreen.embeded[_ngcontent-%COMP%]{display:none}.mode-button.embeded[_ngcontent-%COMP%]{display:none!important}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}button[_ngcontent-%COMP%]{z-index:1000}",".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;font-size:40vh}.conditional-visible.intentional[_ngcontent-%COMP%]{opacity:.25;visibility:visible;pointer-events:auto}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto;font-size:50vh}"]})};export{E as a};
