import{a as D,c as E,d as k}from"./chunk-7ZI236EU.js";import{b as S,c as L}from"./chunk-ADTEVJME.js";import{b as O}from"./chunk-KXQDTQKY.js";import{$b as x,Ab as y,Bb as m,Cb as d,Mb as I,Sa as u,Yb as T,_b as M,db as v,hb as g,ra as c,ua as f,wb as b,yb as C,zb as _}from"./chunk-IJT6L7D7.js";import{i as p,j as w}from"./chunk-HVQDNULJ.js";function $(o,e){if(o&1&&(m(0,"mat-icon",2),M(1),d()),o&2){let i=e.$implicit,t=e.$index,n=I(),r=n.intentionalCues[t];T("visible",n.showIcon()[i.class])("intentional",n.showIntentionalIcon()[r.class]),u(),x(i.value)}}var P=class o extends E{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];intentionalCues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];showIcon=c(Object.fromEntries(this.cues.map(e=>[e.class,!1])));showIntentionalIcon=c(Object.fromEntries(this.intentionalCues.map(e=>[e.class,!1])));fullWindowLink="/experiments/motor-imagery/intentional/stimuli";normalWindowLink="/experiments/motor-imagery/intentional";startCountdownValue=5;ngOnInit(){return w(this,null,function*(){p(o.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Intentional Motor Imagery" CYAN 3;')})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.showIcon.set(Object.fromEntries(this.cues.map(i=>[i.class,i.class===e])))}showIntentionalTrial(e){this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(i=>[i.class,i.class===e])))}stopStimuliSequence(){this.showTrial(null),this.showIntentionalTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,n=[],r=()=>{n.forEach(s=>window.clearTimeout(s)),n=[]},h=()=>{if(t>=e.length){r(),this.onDelivery.set(!1);return}let s=e[t],R=i+e.slice(0,t).reduce((l,a)=>l+a.duration+a.intentional_duration+a.soa,0),N=Math.max(0,R-performance.now()),F=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "intention: ${s.class}" YELLOW;`),this.showIntentionalTrial(s.class),console.log("intentional");let l=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "imagery: ${s.class}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(s.class),console.log("trial");let a=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),console.log("end"),t++,this.setProgress(100*t/e.length),h()},s.duration);n.push(a)},s.intentional_duration);n.push(l)},N);n.push(F)};return h(),r}static \u0275fac=(()=>{let e;return function(t){return(e||(e=f(o)))(t||o)}})();static \u0275cmp=v({type:o,selectors:[["app-stimuli"]],features:[g],decls:3,vars:1,consts:[[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible","intentional"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(m(0,"app-stimuli-layout",0),C(1,$,2,5,"mat-icon",1,b),d()),i&2&&(y("hostRef",t),u(),_(t.cues))},dependencies:[L,S,D,O,k],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;transition:opacity .3s ease,font-size .3s ease}.conditional-visible.intentional[_ngcontent-%COMP%]{opacity:.25;visibility:visible}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;font-size:50vh}"]})};export{P as a};
