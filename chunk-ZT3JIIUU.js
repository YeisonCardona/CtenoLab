import{a as P,b as p,c as A,d as N}from"./chunk-D7WD6YWT.js";import{b as R,c as D}from"./chunk-62AV6QVL.js";import{b as k}from"./chunk-7J34S6W5.js";import{$b as O,Ab as x,Bb as d,Cb as h,Mb as E,Sa as m,Yb as L,_b as M,db as b,hb as C,ra as u,tb as I,ua as y,wb as T,yb as _,zb as S}from"./chunk-P6GYV7WW.js";import{h as c,i as w,j as v}from"./chunk-HVQDNULJ.js";function U(f,e){if(f&1&&(d(0,"mat-icon",3,0),M(2),h()),f&2){let t=e.$implicit,i=e.$index,n=E(),r=n.intentionalCues[i];L("visible",n.showIcon()[t.class])("intentional",n.showIntentionalIcon()[r.class]),I("cue-key",n.fixClass(t.class)),m(2),O(t.value)}}var a=class a extends A{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];intentionalCues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];showIcon=u(Object.fromEntries(this.cues.map(e=>[e.class,!1])));showIntentionalIcon=u(Object.fromEntries(this.intentionalCues.map(e=>[e.class,!1])));fullWindowLink="/paradigms/motor-imagery/intentional/stimuli";normalWindowLink="/paradigms/motor-imagery/intentional";startCountdownValue=5;ngOnInit(){return v(this,null,function*(){w(a.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Intentional Motor Imagery" BLUE 3;')})}generateTrials(){let e=[];for(let t of this.experimentConfig.classes)for(let i=0;i<this.experimentConfig.trials_per_class;i++)e.push({class:t,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.showIcon.set(Object.fromEntries(this.cues.map(t=>[t.class,t.class===e])))}showIntentionalTrial(e){this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(t=>[t.class,t.class===e])))}setOpacity(e,t){let i=this.cuesElement.find(n=>n._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(e));i&&(i._elementRef.nativeElement.style.opacity=t.toString())}stopStimuliSequence(){this.showTrial(null),this.showIntentionalTrial(null)}runStimuliSequence(){let e=this.generateTrials(),t=performance.now(),i=0,n=[],r=()=>{n.forEach(s=>window.clearTimeout(s)),n=[]},g=()=>{if(i>=e.length){r(),this.onDelivery.set(!1);return}let s=e[i],$=t+e.slice(0,i).reduce((l,o)=>l+o.duration+o.intentional_duration+o.soa,0),B=Math.max(0,$-performance.now()),F=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Intention Start: ${s.class}" GREEN;`),this.showIntentionalTrial(s.class),console.log("intentional");let l=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Imagery Start: ${s.class}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(s.class),console.log("trial");let o=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Imagery End: ${s.class}" ORANGE;`),this.showTrial(null),console.log("end"),i++,this.setProgress(100*i/e.length),g()},s.duration);n.push(o)},s.intentional_duration);n.push(l)},B);n.push(F)};return g(),r}static \u0275fac=(()=>{let e;return function(i){return(e||(e=y(a)))(i||a)}})();static \u0275cmp=b({type:a,selectors:[["app-stimuli"]],features:[C],decls:3,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible","intentional"],[1,"center","cue","conditional-visible"]],template:function(t,i){t&1&&(d(0,"app-stimuli-layout",1),_(1,U,3,6,"mat-icon",2,T),h()),t&2&&(x("hostRef",i),m(),S(i.cues))},dependencies:[D,R,P,k,N],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;transition:opacity .3s ease,font-size .3s ease}.conditional-visible.intentional[_ngcontent-%COMP%]{opacity:.25;visibility:visible}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;font-size:50vh}"]})};c([p("TRIAL",{arguments:["CLASS"],example:"Trial Right",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],a.prototype,"showTrial",1),c([p("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Right 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],a.prototype,"setOpacity",1);var G=a;export{G as a};
