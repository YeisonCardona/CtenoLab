import{a as R,b as I,c as A,d as q}from"./chunk-EVPFZQXT.js";import{c as P}from"./chunk-62AV6QVL.js";import{b as D}from"./chunk-7J34S6W5.js";import{$b as T,Ab as k,Bb as c,Cb as u,Mb as y,Sa as r,Yb as C,_b as b,db as _,hb as L,ra as h,tb as f,ua as O,wb as g,yb as v,zb as w}from"./chunk-P6GYV7WW.js";import{h as d,i as M,j as E}from"./chunk-HVQDNULJ.js";function U(o,e){if(o&1&&(c(0,"span",4,0),b(2),u()),o&2){let i=e.$implicit,t=y();C("intentional",t.showIcon()[i.class]),f("cue-key",t.fixClass(i.class)),r(2),T(i.value)}}function V(o,e){if(o&1&&(c(0,"span",4,0),b(2),u()),o&2){let i=e.$implicit,t=y();C("visible",t.showIntentionalIcon()[i.class]),f("cue-key",t.fixClass(i.class)),r(2),T(i.value)}}var a=class a extends A{cues=[];intentionalCues=[];showIcon=h(Object.fromEntries(this.cues.map(e=>[e.class,!1])));showIntentionalIcon=h(Object.fromEntries(this.intentionalCues.map(e=>[e.class,!1])));fullWindowLink="/paradigms/motor-imagery/sequential/stimuli";normalWindowLink="/paradigms/motor-imagery/sequential";startCountdownValue=5;ngOnInit(){return E(this,null,function*(){M(a.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Sequential Motor Imagery" BLUE 3;'),this.cues=Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]})),this.intentionalCues=Object.keys(this.stimulusCommandMap).map(e=>({class:e,value:e,keys:this.stimulusCommandMap[e]}))})}generateTrials(){let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){let i;e!==null?i=e.split("-").map(n=>n.trim())[0]:i=null,this.showIcon.set(Object.fromEntries(this.cues.map(t=>[t.class,t.class===i])))}showIntentionalTrial(e){let i;e!==null?i=e.split("-").map(n=>n.trim())[1]:i=null,this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(t=>[t.class,t.class===i])))}setOpacity(e,i){let t=this.cuesElement.find(n=>n._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(e));t&&(t._elementRef.nativeElement.style.opacity=i.toString())}stopStimuliSequence(){this.showTrial(null),this.showIntentionalTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,n=[],x=()=>{n.forEach(s=>window.clearTimeout(s)),n=[]},S=()=>{if(t>=e.length){x(),this.onDelivery.set(!1);return}let s=e[t],j=i+e.slice(0,t).reduce((m,l)=>m+l.duration+l.duration+l.soa,0),B=Math.max(0,j-performance.now()),F=window.setTimeout(()=>{let m=s.class.split("-").map(p=>p.trim());this.hardwareService.writeLine(`CMD=@LOG "1st: ${m[1]}" GREEN;`),this.showIntentionalTrial(s.class);let l=window.setTimeout(()=>{let p=s.class.split("-").map(N=>N.trim());this.hardwareService.writeLine(`CMD=@LOG "2nd: ${p[0]}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(s.class);let $=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial End: ${s.class}" ORANGE;`),this.showTrial(null),console.log("end"),t++,this.setProgress(100*t/e.length),S()},s.duration);n.push($)},s.duration);n.push(l)},B);n.push(F)};return S(),x}static \u0275fac=(()=>{let e;return function(t){return(e||(e=O(a)))(t||a)}})();static \u0275cmp=_({type:a,selectors:[["app-stimuli"]],features:[L],decls:5,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"intentional"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(c(0,"app-stimuli-layout",1),v(1,U,3,4,"span",2,g),v(3,V,3,4,"span",3,g),u()),i&2&&(k("hostRef",t),r(),w(t.cues),r(2),w(t.intentionalCues))},dependencies:[P,R,D,q],styles:['.cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:100%;height:1em;font-family:"monospace"!important;text-align:center;text-transform:uppercase;letter-spacing:.1em;font-size:10vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.intentional[_ngcontent-%COMP%], .conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible}']})};d([I("TRIAL",{arguments:["CLASS"],example:"Trial Grasp",description:"Highlights the specified class by activating its visual icon while deactivating all others. Useful for indicating the target class during a trial or cue presentation."})],a.prototype,"showTrial",1),d([I("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Pull 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],a.prototype,"setOpacity",1);var G=a;export{G as a};
