import{c as ne}from"./chunk-OWSNVMTI.js";import"./chunk-MKG7IB6M.js";import{c as ae,h as oe,i as re,j as le,k as ce}from"./chunk-A2A35ACL.js";import"./chunk-HNOTP6PA.js";import{a as Y,d as J,g as X,j as K,k as Z,l as ee}from"./chunk-6GID3F7O.js";import"./chunk-ZOZSFTET.js";import{a as q,b as Q}from"./chunk-UAQ7UU4Y.js";import{a as $,b as z}from"./chunk-M5Y3KVA3.js";import{b as ie}from"./chunk-GB5JM2T7.js";import"./chunk-XP57CNC4.js";import"./chunk-4ULVSNUU.js";import{b as te}from"./chunk-XSAIEII5.js";import"./chunk-3C6VJBNL.js";import{b as j,c as U}from"./chunk-62AV6QVL.js";import"./chunk-7Q5CT564.js";import"./chunk-75WOWH2T.js";import"./chunk-6Q6ZBUD2.js";import"./chunk-NXQCXCLR.js";import{j as F,l as N,o as A}from"./chunk-RPD344RW.js";import{l as W,m as G}from"./chunk-IAEIATSC.js";import{$b as k,Ab as h,Bb as a,Cb as o,Db as d,Hb as T,Lb as v,Mb as s,Pa as P,Qb as I,Rb as M,Sa as r,Sb as E,Xa as b,Yb as L,_b as i,ac as u,db as O,ga as f,ha as x,lc as C,mc as w,ra as _,tb as R,tc as V,ub as m,vb as p,wb as H,yb as D,zb as B}from"./chunk-P6GYV7WW.js";import{j as y}from"./chunk-HVQDNULJ.js";var de=["taskPanel"],me=["ssidInput"],pe=["passwordInput"];function ue(t,n){t&1&&(a(0,"p"),i(1,"Using "),a(2,"strong"),i(3,"WebUSB"),o(),i(4,". This is the preferred method for communicating with supported hardware."),o())}function _e(t,n){t&1&&(a(0,"p"),i(1,"Using "),a(2,"strong"),i(3,"Web Serial API"),o(),i(4,". This is an alternative method for devices that support serial communication."),o())}function Ce(t,n){if(t&1){let e=T();a(0,"button",8),v("click",function(){f(e);let l=s(2);return x(l.hardwareService.core.autoConnect())}),i(1," Auto-Connect to Hardware "),a(2,"mat-icon"),i(3,"usb"),o()()}}function we(t,n){if(t&1){let e=T();a(0,"div",7)(1,"button",8),v("click",function(){f(e);let l=s();return x(l.hardwareService.core.requestAndConnectDevice())}),i(2," Select Hardware to Connect "),a(3,"mat-icon"),i(4,"usb"),o()(),m(5,Ce,4,0,"button",9),o()}if(t&2){let e=s();r(5),p(e.hardwareService.core.hasAvailableDevice()?5:-1)}}function fe(t,n){if(t&1&&(a(0,"b"),i(1),o(),i(2),d(3,"br")),t&2){let e=n.$implicit;r(),u("",e.name,":"),r(),u(" ",e.value)}}function xe(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().latency*1e3,"1.0-2")," \xB5s ")}}function ve(t,n){t&1&&i(0," ??? ")}function he(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().jitter*1e3,"1.0-2")," \xB5s ")}}function Se(t,n){t&1&&i(0," ??? ")}function ge(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().min*1e3,"1.0-2")," \xB5s ")}}function be(t,n){t&1&&i(0," ??? ")}function Te(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().max*1e3,"1.0-2")," \xB5s ")}}function ye(t,n){t&1&&i(0," ??? ")}function Pe(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().median*1e3,"1.0-2")," \xB5s ")}}function Ie(t,n){t&1&&i(0," ??? ")}function Me(t,n){if(t&1&&i(0),t&2){let e=s(2);u(" ",e.hardwareService.core.latencyStats().samples," ")}}function Ee(t,n){t&1&&i(0," ??? ")}function He(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().latency/2*1e3,"1.0-2")," \xB5s ")}}function De(t,n){t&1&&i(0," ??? ")}function Be(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().jitter/2*1e3,"1.0-2")," \xB5s ")}}function Le(t,n){t&1&&i(0," ??? ")}function ke(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().min/2*1e3,"1.0-2")," \xB5s ")}}function Oe(t,n){t&1&&i(0," ??? ")}function Re(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().max/2*1e3,"1.0-2")," \xB5s ")}}function Ve(t,n){t&1&&i(0," ??? ")}function We(t,n){if(t&1&&(i(0),C(1,"number")),t&2){let e=s(2);u(" ",w(1,1,e.hardwareService.core.latencyStats().median/2*1e3,"1.0-2")," \xB5s ")}}function Ge(t,n){t&1&&i(0," ??? ")}function Fe(t,n){if(t&1&&i(0),t&2){let e=s(2);u(" ",e.hardwareService.core.latencyStats().samples," ")}}function Ne(t,n){t&1&&i(0," ??? ")}function Ae(t,n){if(t&1){let e=T();a(0,"div",10)(1,"button",11),v("click",function(){f(e);let l=s();return x(l.hardwareService.core.disconnect())}),i(2," Disconnect from Hardware "),a(3,"mat-icon"),i(4,"usb_off"),o()(),a(5,"button",8),v("click",function(){f(e);let l=s();return x(l.testConnection())}),i(6," Test Connection "),o()(),a(7,"div",12)(8,"p",13),i(9,"Connection successful!"),o(),a(10,"p",14),i(11,"Connection failed!"),o()(),d(12,"mat-divider"),a(13,"p",12),D(14,fe,4,2,null,null,H),o(),d(16,"mat-divider"),a(17,"div",15)(18,"button",16),v("click",function(){f(e);let l=s();return x(l.hardwareService.core.measureLatency())}),i(19," Start Latency Test "),a(20,"mat-icon"),i(21,"acute"),o()(),a(22,"p")(23,"b"),i(24,"Latency (RTT)"),o(),i(25," corresponds to the round-trip time measured from the moment a message is sent until a response is received, using high-precision timestamps. This is the "),a(26,"b"),i(27,"actual measured delay"),o(),i(28," and includes both transmission and return paths. "),o(),a(29,"p"),i(30," The values shown on the right represent an "),a(31,"b"),i(32,"estimated one-way latency"),o(),i(33,", calculated by dividing RTT-based measurements by two. This estimation "),a(34,"b"),i(35,"assumes symmetrical communication delay"),o(),i(36," and is provided for reference only. "),o(),a(37,"div",17)(38,"p")(39,"b"),i(40,"Latency (RTT):"),o(),m(41,xe,2,4)(42,ve,1,0),d(43,"br"),a(44,"b"),i(45,"Jitter (RTT):"),o(),m(46,he,2,4)(47,Se,1,0),d(48,"br"),a(49,"b"),i(50,"Min:"),o(),m(51,ge,2,4)(52,be,1,0),d(53,"br"),a(54,"b"),i(55,"Max:"),o(),m(56,Te,2,4)(57,ye,1,0),d(58,"br"),a(59,"b"),i(60,"Median:"),o(),m(61,Pe,2,4)(62,Ie,1,0),d(63,"br"),a(64,"b"),i(65,"Samples:"),o(),m(66,Me,1,1)(67,Ee,1,0),o(),a(68,"p")(69,"b"),i(70,"Latency:"),o(),m(71,He,2,4)(72,De,1,0),d(73,"br"),a(74,"b"),i(75,"Jitter:"),o(),m(76,Be,2,4)(77,Le,1,0),d(78,"br"),a(79,"b"),i(80,"Min:"),o(),m(81,ke,2,4)(82,Oe,1,0),d(83,"br"),a(84,"b"),i(85,"Max:"),o(),m(86,Re,2,4)(87,Ve,1,0),d(88,"br"),a(89,"b"),i(90,"Median:"),o(),m(91,We,2,4)(92,Ge,1,0),d(93,"br"),a(94,"b"),i(95,"Samples:"),o(),m(96,Fe,1,1)(97,Ne,1,0),o()()(),d(98,"mat-divider")(99,"p",18),a(100,"div",19)(101,"mat-form-field",20)(102,"mat-label"),i(103,"Network (SSID)"),o(),d(104,"input",21,1),o(),a(106,"mat-form-field",20)(107,"mat-label"),i(108,"WiFi Password"),o(),d(109,"input",22,2),a(111,"button",23),v("click",function(l){f(e);let S=s();return x(S.clickEventHidePassword(l))}),a(112,"mat-icon"),i(113),o()()()(),a(114,"button",24),v("click",function(){f(e);let l=s();return x(l.connectToWifi())}),i(115," Connect Hardware to WiFi "),a(116,"mat-icon"),i(117,"wifi"),o()(),d(118,"p",25)(119,"p",26)}if(t&2){let e=s();r(8),L("active",e.successConnectedMessage()),r(2),L("active",e.failConnectedMessage()),r(4),B(e.hardwareService.core.getProperties()),r(4),h("disabled",e.hardwareService.core.measuringLatency()),r(23),p(e.hardwareService.core.latencyStats().latency>0?41:42),r(5),p(e.hardwareService.core.latencyStats().jitter>0?46:47),r(5),p(e.hardwareService.core.latencyStats().min>0?51:52),r(5),p(e.hardwareService.core.latencyStats().max>0?56:57),r(5),p(e.hardwareService.core.latencyStats().median>0?61:62),r(5),p(e.hardwareService.core.latencyStats().samples>0?66:67),r(5),p(e.hardwareService.core.latencyStats().latency>0?71:72),r(5),p(e.hardwareService.core.latencyStats().jitter>0?76:77),r(5),p(e.hardwareService.core.latencyStats().min>0?81:82),r(5),p(e.hardwareService.core.latencyStats().max>0?86:87),r(5),p(e.hardwareService.core.latencyStats().median>0?91:92),r(5),p(e.hardwareService.core.latencyStats().samples>0?96:97),r(3),h("innerHTML",e.autoConnectedIP(),P),r(5),h("value",e.lastSSID()),r(5),h("value",e.lastPassword())("type",e.hidePassword()?"password":"text"),r(2),R("aria-label","Hide password")("aria-pressed",e.hidePassword()),r(2),k(e.hidePassword()?"visibility_off":"visibility"),r(),h("disabled",e.connectingToWifi()),r(4),h("innerHTML",e.connectionMessage(),P),r(),h("innerHTML",e.howToConnect(),P)}}function je(t,n){if(t&1){let e=T();a(0,"button",29),v("click",function(){let l=f(e).$implicit,S=s(2);return x(S.onCommand(l))}),i(1),o()}if(t&2){let e=n.$implicit;r(),k(e)}}function Ue(t,n){if(t&1&&(d(0,"mat-divider"),a(1,"div",27),D(2,je,2,1,"button",28,H),o()),t&2){let e=s();r(2),B(e.testCommands)}}var se=class t{constructor(n,e,c,l,S){this.navigationService=n;this.breadcrumbService=e;this.hardwareService=c;this.supabaseService=l;this.dialog=S;n.setActiveLink("/hardware-control-panel"),this.breadcrumbService.setBreadcrumbs([{label:"Home",url:"/home"},{label:"Hardware Control Panel",url:"/hardware-control-panel"}]),V(()=>{let g=c.core.hardwareIP();g&&(this.connectionMessage.set(`Connection successful: <b>${g}</b>`),this.howToConnect.set(`
  To interact with the Cardputer, simply access the URL
  <code>http://${g}/?c=CMD=...</code> from any web browser or HTTP client.
  You can send multiple commands separated by semicolons (<code>;</code>), and each must include the <code>CMD=</code> prefix.
  For example:
  <code>http://${g}/?c=CMD=BRAND;CMD=BIP;</code>.
  The system will interpret each command as if it were typed in the serial REPL interface.
`))})}taskPanel;ssidInput;passwordInput;autoConnectedIP=_("");hidePassword=_(!0);lastSSID=_(localStorage.getItem("cteno-hardware-connection-ssid")||"");lastPassword=_(localStorage.getItem("cteno-hardware-connection-password")||"");lastIP=_(localStorage.getItem("cteno-hardware-connection-ip")||"");connectionMessage=_("");connectingToWifi=_(!1);howToConnect=_("");selectedInterface="auto";successConnectedMessage=_(!1);failConnectedMessage=_(!1);devMode=window.location.hostname.startsWith("localhost");connectionType=_("serial");intervalId;timeOutId;requieredTier="Hobbyist";startTierInspection(n=3e3,e=1e3){this.timeOutId=window.setTimeout(()=>{let c=this.supabaseService.getTierLevel(this.supabaseService.userTier()),l=this.supabaseService.getTierLevel(this.requieredTier);this.intervalId=window.setInterval(()=>{c<l?this.taskPanel?.nativeElement?.classList?.add("locked"):this.taskPanel?.nativeElement?.classList?.remove("locked")},e),c<l&&this.dialog.open(oe,{data:{title:"Tier Restriction!",question:`This paradigm is only available to users with the <b>${this.requieredTier}</b> plan or higher.`,confirmText:"Got it"}})},n)}ngOnInit(){let n=localStorage.getItem("cteno-hardware-connection-mode"),e=n==="usb"||n==="serial"?n:"serial";this.connectionType.set(e),this.onConnectionTypeChange(e),this.startTierInspection()}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId),this.timeOutId&&clearInterval(this.timeOutId)}selectConnectionType(n){this.connectionType.set(n),this.onConnectionTypeChange(n)}onConnectionTypeChange(n){this.hardwareService.setMode(n)}testConnection(){return y(this,null,function*(){this.hardwareService.core.flushQueues(),yield this.hardwareService.core.writeLine("CMD=PING;CMD=@BIP 1000 100 128;CMD=@BRAND;");let n=yield this.hardwareService.core.readLine();this.successConnectedMessage.set(n==="RESP=PONG;"),this.failConnectedMessage.set(n!=="RESP=PONG;")})}onCommand(n){return y(this,null,function*(){yield this.hardwareService.core.writeLine(n)})}clickEventHidePassword(n){this.hidePassword.set(!this.hidePassword()),n.stopPropagation()}connectToWifi(){return y(this,null,function*(){this.connectingToWifi.set(!0),this.connectionMessage.set("Connecting to WiFi...");let n=this.ssidInput.nativeElement.value,e=this.passwordInput.nativeElement.value;localStorage.setItem("cteno-hardware-connection-ssid",n),localStorage.setItem("cteno-hardware-connection-password",e),yield this.hardwareService.core.writeLine('CMD=WIFI "'+n+'" "'+e+'";');let c=0;for(;;){let l=yield this.hardwareService.readLine();if(l==="RESP=WIFI_FAILED;"){this.connectionMessage.set("Connection failed. Please check your SSID and password."),yield this.hardwareService.core.writeLine("CMD=BIP 2000 100 100;"),yield this.hardwareService.core.writeLine("CMD=BIP 2000 100 100;");break}else if(l.startsWith("RESP=WIFI_CONNECTED")){let S=l.split("IP=")[1]?.replace(";","");this.hardwareService.hardwareIP.set(S),localStorage.setItem("cteno-hardware-connection-ip",S),yield this.hardwareService.core.writeLine("CMD=BIP;");break}if(c++,c>50){this.connectionMessage.set("Connection timed out. Please check your SSID and password.");break}}this.connectingToWifi.set(!1)})}testCommands=['CMD=WIFI "DunderLab 2.4GHz" "?1n9u1n0";',"CMD=PING;","CMD=BIP 1000 100 128;","CMD=BRAND;","CMD=BIP;","CMD=BIP 3000;","CMD=BIP 1000 500;","CMD=BIP 2000 300 64;","CMD=BIP 2000 300 128;","CMD=BIP 2000 300 255;","CMD=CLA;",'CMD=LOG "testing log message";','CMD=LOG "testing log message" WHITE;','CMD=LOG "testing log message" RED;','CMD=LOG "testing log message" ORANGE;','CMD=LOG "testing log message" YELLOW;','CMD=LOG "testing log message" GREEN;','CMD=LOG "testing log message" BLUE;','CMD=LOG "testing log message" PURPLE;','CMD=LOG "This is a long title that should wrap automatically across multiple lines if it doesnt fit.";','CMD=TITLE "This is a long title that should wrap automatically across multiple lines if it doesnt fit.";','CMD=TITLE "Unilateral Motor Imagery" BLUE;','CMD=TITLE "Unilateral Motor Imagery" RED 3;','CMD=TITLE "Motor Imagery" YELLOW 4;',`EXIT
`];static \u0275fac=function(e){return new(e||t)(b($),b(z),b(ie),b(te),b(ae))};static \u0275cmp=O({type:t,selectors:[["app-hardware-control-panel"]],viewQuery:function(e,c){if(e&1&&(I(de,5),I(me,5),I(pe,5)),e&2){let l;M(l=E())&&(c.taskPanel=l.first),M(l=E())&&(c.ssidInput=l.first),M(l=E())&&(c.passwordInput=l.first)}},decls:15,vars:4,consts:[["taskPanel",""],["ssidInput",""],["passwordInput",""],["name","connectionType","aria-label","Connection Type",3,"change","value"],["value","usb"],["value","serial"],[1,"margin-bottom-large"],[1,"flex-row","margin-bottom-large"],["matButton","filled",3,"click"],["matButton","filled"],[1,"flex-row"],["matButton","filled",1,"disconnect",3,"click"],[1,"margin-top-large"],[1,"success"],[1,"fail"],[1,"margin-bottom-large","margin-top-large"],["matButton","filled",3,"click","disabled"],[1,"grid-responsive-2"],[1,"margin-top-large",3,"innerHTML"],[1,"flex-row","margin-top-large"],["appearance","outline",1,"wifi-form-field"],["matInput","",3,"value"],["matInput","",3,"value","type"],["matIconButton","","matSuffix","",3,"click"],["matButton","filled",1,"margin-bottom-large",3,"click","disabled"],[1,"no-margin-top",3,"innerHTML"],[3,"innerHTML"],[1,"button-row","margin-top-large"],["matButton","tonal",1,"command-button"],["matButton","tonal",1,"command-button",3,"click"]],template:function(e,c){if(e&1){let l=T();a(0,"div",null,0)(2,"h1"),i(3,"Hardware Control Panel"),o(),a(4,"mat-button-toggle-group",3),v("change",function(g){return f(l),x(c.selectConnectionType(g.value))}),a(5,"mat-button-toggle",4),i(6,"USB"),o(),a(7,"mat-button-toggle",5),i(8,"Serial"),o()(),a(9,"div",6),m(10,ue,5,0,"p")(11,_e,5,0,"p"),o(),m(12,we,6,1,"div",7)(13,Ae,120,27),m(14,Ue,4,0),o()}e&2&&(r(4),h("value",c.hardwareService.connectionMode()),r(6),p(c.connectionType()==="usb"?10:c.connectionType()==="serial"?11:-1),r(2),p(c.hardwareService.core.isConnected()?13:12),r(2),p(c.supabaseService.userTier()==="Developer"?14:-1))},dependencies:[A,N,F,Q,q,U,j,ee,Z,X,Y,J,K,G,W,ce,re,le,ne],styles:[".disconnect[_ngcontent-%COMP%]{background-color:var(--mat-sys-error)!important}.success[_ngcontent-%COMP%]{display:none}.success.active[_ngcontent-%COMP%]{display:block;color:var(--mat-sys-primary)}.fail[_ngcontent-%COMP%]{display:none}.fail.active[_ngcontent-%COMP%]{display:block;color:var(--mat-sys-error)}.button-row[_ngcontent-%COMP%]{display:flex;flex-flow:wrap;gap:8px;justify-content:space-evenly}.command-button[_ngcontent-%COMP%]{font-family:monospace;font-size:.8rem}.wifi-form-field[_ngcontent-%COMP%]{width:100%}"]})};export{se as HardwareControlPanel};
