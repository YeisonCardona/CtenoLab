import{a as $,b as q,c as U,d as V}from"./chunk-PSHI5EDA.js";import{a as G}from"./chunk-WF6OUPN2.js";import{a as H}from"./chunk-B7YIEC7Z.js";import{a as N,b as W}from"./chunk-TH2QI45C.js";import{b as z,c as j}from"./chunk-BN5QOK7L.js";import{a as R,c as A,d as F}from"./chunk-IU7NWVGQ.js";import{j as B}from"./chunk-EXEM6OM4.js";import{Ab as h,Bb as o,Cb as a,Db as w,Jb as c,Kb as E,Pa as T,Sa as r,Vb as M,Wb as f,Xa as v,Xb as u,Yb as s,Zb as L,db as O,fc as D,gc as d,hb as P,ra as _,wb as k,yb as I,zb as x}from"./chunk-FHWKK7EC.js";import{h as y,i as S}from"./chunk-5KHZBZE7.js";function X(m,t){if(m&1&&(o(0,"mat-icon",11),s(1),a()),m&2){let i=t.$implicit,e=t.$index,n=E(),b=n.intentionalCues[e];f("visible",n.showIcon()[i.class])("intentional",n.showIntentionalIcon()[b.class]),r(),L(i.value)}}var Y=class m extends U{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];intentionalCues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];showIcon=_(Object.fromEntries(this.cues.map(t=>[t.class,!1])));showIntentionalIcon=_(Object.fromEntries(this.intentionalCues.map(t=>[t.class,!1])));fullWindowLink="/experiments/motor-imagery/intentional/stimuli";normalWindowLink="/experiments/motor-imagery/intentional";startCountdownValue=5;constructor(t,i,e,n){super(t,i,e,n)}ngOnInit(){return S(this,null,function*(){y(m.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Intentional Motor Imagery" CYAN 3;')})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let t=[];for(let i of this.experimentConfig.classes)for(let e=0;e<this.experimentConfig.trials_per_class;e++)t.push({class:i,duration:this.experimentConfig.stimulus_duration,intentional_duration:this.experimentConfig.intentional_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return t=this.shuffle(t),t}showTrial(t){this.showIcon.set(Object.fromEntries(this.cues.map(i=>[i.class,i.class===t])))}showIntentionalTrial(t){this.showIntentionalIcon.set(Object.fromEntries(this.intentionalCues.map(i=>[i.class,i.class===t])))}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let t=this.generateTrials(),i=performance.now(),e=0,n=[],b=()=>{n.forEach(l=>window.clearTimeout(l)),n=[]},C=()=>{if(e>=t.length){b(),this.onDelivery.set(!1);return}let l=t[e],J=i+t.slice(0,e).reduce((g,p)=>g+p.duration+p.intentional_duration+p.soa,0),K=Math.max(0,J-performance.now()),Q=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "intention: ${l.class}" YELLOW;`),this.showIntentionalTrial(l.class),console.log("intentional");let g=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "imagery: ${l.class}" GREEN;`),this.showIntentionalTrial(null),this.showTrial(l.class),console.log("trial");let p=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),console.log("end"),e++,this.setProgress(100*e/t.length),C()},l.duration);n.push(p)},l.intentional_duration);n.push(g)},K);n.push(Q)};return C(),b}static \u0275fac=function(i){return new(i||m)(v(R),v(H),v(A),v(G))};static \u0275cmp=O({type:m,selectors:[["app-stimuli"]],features:[P],decls:26,vars:27,consts:[["matIconButton","","matTooltip","\u26A0\uFE0F Stop stimulus delivery",1,"stop","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Starting will begin stimulus delivery",1,"start","conditional-visible-b","top-left",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Fullscreen will restart stimulus delivery",3,"click"],["matIconButton","","matTooltip","\u26A0\uFE0F Exiting fullscreen will restart stimulus delivery",3,"click","routerLink"],["matIconButton","","id","mode-light",3,"click"],["matIconButton","","id","mode-dark",3,"click"],[1,"bottom-left"],[1,"center","counter",3,"innerHTML"],[1,"center","fixation"],[1,"center","cue","conditional-visible",3,"visible","intentional"],["mode","determinate",3,"value"],[1,"center","cue","conditional-visible"]],template:function(i,e){i&1&&(o(0,"div")(1,"button",0),c("click",function(){return e.stopSequence()}),o(2,"mat-icon"),s(3,"stop_circle"),a()(),o(4,"button",1),c("click",function(){return e.startCountdown()}),o(5,"mat-icon"),s(6,"play_circle"),a()(),o(7,"button",2),c("click",function(){return e.gotoFullWindow()}),o(8,"mat-icon"),s(9,"arrows_output"),a()(),o(10,"button",3),c("click",function(){return e.stopSequence()}),o(11,"mat-icon"),s(12,"fullscreen_exit"),a()(),o(13,"button",4),c("click",function(){return e.setReactiveMode("light")}),o(14,"mat-icon"),s(15,"light_mode"),a()(),o(16,"button",5),c("click",function(){return e.setReactiveMode("dark")}),o(17,"mat-icon"),s(18,"dark_mode"),a()(),w(19,"app-hardware",6)(20,"span",7),o(21,"mat-icon",8),s(22,"point_scan"),a(),I(23,X,2,5,"mat-icon",9,k),w(25,"mat-progress-bar",10),a()),i&2&&(u(d("screen ",e.embeded)),r(),f("visible-b",e.onDelivery()),r(3),f("visible-b",!e.onDelivery()),r(3),u(d("bottom-right fullscreen ",e.embeded)),r(3),u(d("bottom-right appscreen ",e.embeded)),h("routerLink",D(e.normalWindowLink)),r(3),u(d("top-right mode-button ",e.embeded)),M("display",e.currentMode==="dark"?"flex":"none"),r(3),u(d("top-right mode-button ",e.embeded)),M("display",e.currentMode==="dark"?"none":"flex"),r(4),h("innerHTML",e.countdownTimer(),T),r(3),x(e.cues),r(2),h("value",e.progressValue()))},dependencies:[j,z,B,q,$,F,V,W,N],styles:[".start[_ngcontent-%COMP%], .stop[_ngcontent-%COMP%]{scale:2}.conditional-visible-b.visible-b[_ngcontent-%COMP%]{visibility:visible}.conditional-visible-b[_ngcontent-%COMP%]{visibility:hidden}.screen[_ngcontent-%COMP%]{background-color:var(--mat-sys-inverse-surface);width:100vw;height:100vh;position:relative;box-sizing:border-box;overflow:hidden}.screen.embeded[_ngcontent-%COMP%]{border-radius:var(--mat-sys-corner-large);width:100%;height:50vh;margin:0 auto}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.counter[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);font:var(--mat-sys-body-small);font-size:12vh}.fixation[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);z-index:9999}.bottom-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;bottom:16px}.bottom-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;bottom:16px}.top-left[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;left:16px;top:16px}.top-right[_ngcontent-%COMP%]{color:var(--mat-sys-inverse-on-surface);position:absolute;right:16px;top:16px}button.top-left[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], button.bottom-right[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:1em;height:1em}.stop[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.fullscreen[_ngcontent-%COMP%]{display:none}.appscreen[_ngcontent-%COMP%], .fullscreen.embeded[_ngcontent-%COMP%]{display:block}.appscreen.embeded[_ngcontent-%COMP%]{display:none}.mode-button.embeded[_ngcontent-%COMP%]{display:none!important}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}button[_ngcontent-%COMP%]{z-index:1000}",".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;font-size:40vh;transition:opacity .3s ease,font-size .3s ease}.conditional-visible.intentional[_ngcontent-%COMP%]{opacity:.25;visibility:visible;pointer-events:auto}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto;font-size:50vh}"]})};export{Y as a};
