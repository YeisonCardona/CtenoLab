import{c as P}from"./chunk-VR4UG4MN.js";import{a as k,b as A,c as N,d as F}from"./chunk-7ZI236EU.js";import{k as B}from"./chunk-F66DJCOI.js";import{b as O,c as D}from"./chunk-ADTEVJME.js";import{b as R}from"./chunk-KXQDTQKY.js";import{Ab as x,Bb as l,Cb as c,Mb as I,Sa as a,Yb as _,_b as E,ac as L,db as y,hb as b,ra as v,tb as T,ua as w,wb as C,yb as M,zb as S}from"./chunk-IJT6L7D7.js";import{h,i as f,j as g}from"./chunk-HVQDNULJ.js";function j(m,e){if(m&1&&(l(0,"mat-icon",3,0),E(2),c()),m&2){let i=e.$implicit,t=I();_("visible",t.showIcon()[i.class]),T("cue-key",i.class),a(2),L(" ",i.value," ")}}var n=class n extends N{cues=[{class:"Right",value:"arrow_forward"},{class:"Left",value:"arrow_back"},{class:"Up",value:"arrow_upward"},{class:"Down",value:"arrow_downward"},{class:"Rest",value:"radio_button_unchecked"}];showIcon=v(Object.fromEntries(this.cues.map(e=>[e.class,!1])));fullWindowLink="/experiments/motor-imagery/unilateral/stimuli";normalWindowLink="/experiments/motor-imagery/unilateral";startCountdownValue=5;ngOnInit(){return g(this,null,function*(){f(n.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Unilateral Motor Imagery" CYAN 3;')})}generateTrials(){this.hardwareService.writeLine("CMD=@CLA;");let e=[];for(let i of this.experimentConfig.classes)for(let t=0;t<this.experimentConfig.trials_per_class;t++)e.push({class:i,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return e=this.shuffle(e),e}showTrial(e){this.showIcon.set(Object.fromEntries(this.cues.map(i=>[i.class,i.class===e])))}setOpacity(e,i){let t=this.cuesElement.find(s=>s._elementRef.nativeElement.getAttribute("cue-key")===e);console.log(t),t&&(t._elementRef.nativeElement.style.opacity=i.toString())}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let e=this.generateTrials(),i=performance.now(),t=0,s=[],u=()=>{s.forEach(r=>window.clearTimeout(r)),s=[]},p=()=>{if(t>=e.length){u(),this.onDelivery.set(!1);return}let r=e[t],G=i+e.slice(0,t).reduce((o,d)=>o+d.duration+d.soa,0),U=Math.max(0,G-performance.now()),Y=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "${r.class}" GREEN;`),this.showTrial(r.class);let o=window.setTimeout(()=>{this.hardwareService.writeLine('CMD=@LOG "End" RED;'),this.showTrial(null),t++,this.setProgress(100*t/e.length),p()},r.duration);s.push(o)},U);s.push(Y)};return p(),u}static \u0275fac=(()=>{let e;return function(t){return(e||(e=w(n)))(t||n)}})();static \u0275cmp=y({type:n,selectors:[["app-stimuli"]],features:[b],decls:3,vars:1,consts:[["cueElement",""],[3,"hostRef"],[1,"center","cue","conditional-visible",3,"visible"],[1,"center","cue","conditional-visible"]],template:function(i,t){i&1&&(l(0,"app-stimuli-layout",1),M(1,j,3,4,"mat-icon",2,C),c()),i&2&&(x("hostRef",t),a(),S(t.cues))},dependencies:[D,O,k,R,P,B,F],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:40vh}.conditional-visible[_ngcontent-%COMP%]{opacity:0;visibility:hidden;pointer-events:none;transition:opacity .3s ease,visibility .3s ease}.conditional-visible.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;pointer-events:auto}"]})};h([A("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY Right 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],n.prototype,"setOpacity",1);var q=n;export{q as a};
