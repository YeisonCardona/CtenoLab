import{a as D,b as h,c as A,d as G}from"./chunk-EVPFZQXT.js";import{b as x,c as O}from"./chunk-62AV6QVL.js";import{b as B}from"./chunk-7J34S6W5.js";import{a as _,b as E,c as P}from"./chunk-IUODOC7G.js";import{Ab as C,Bb as m,Cb as f,Mb as I,Sa as l,Yb as M,_b as k,ac as S,db as w,hb as R,ra as L,tb as H,ua as v,wb as y,yb as F,zb as T}from"./chunk-P6GYV7WW.js";import{h as d,i as p,j as b}from"./chunk-HVQDNULJ.js";function U(u,t){if(u&1&&(m(0,"mat-grid-tile")(1,"mat-icon",3,0),k(3),f()()),u&2){let i=t.$implicit,e=t.$index,a=I();l(),M("visible",a.showIcon()[i.class])("mirror",e===0||e===3),H("cue-key",a.fixClass(i.class)),l(2),S("",i.value," ")}}var s=class s extends A{cues=[{class:"Left Hand",value:"back_hand"},{class:"Right Hand",value:"back_hand"},{class:"Left Foot",value:"barefoot"},{class:"Right Foot",value:"barefoot"}];showIcon=L(Object.fromEntries(this.cues.map(t=>[t.class,!1])));fullWindowLink="/paradigms/motor-imagery/bilateral/stimuli";normalWindowLink="/paradigms/motor-imagery/bilateral";startCountdownValue=5;ngOnInit(){return b(this,null,function*(){p(s.prototype,this,"ngOnInit").call(this),yield this.hardwareService.writeLine("CMD=@CLA;"),yield this.hardwareService.writeLine('CMD=@TITLE "Bilateral Motor Imagery" BLUE 3;')})}generateTrials(){let t=[];for(let i of this.experimentConfig.classes)for(let e=0;e<this.experimentConfig.trials_per_class;e++)t.push({class:i,duration:this.experimentConfig.stimulus_duration,soa:this.getRandomSoa(this.experimentConfig.soa)});return t=this.shuffle(t),t}showTrial(t){switch(t){case"Left Hand":this.showIcon.set({"Left Hand":!0,"Right Hand":!1,"Left Foot":!1,"Right Foot":!1});break;case"Right Hand":this.showIcon.set({"Left Hand":!1,"Right Hand":!0,"Left Foot":!1,"Right Foot":!1});break;case"Both Hands":this.showIcon.set({"Left Hand":!0,"Right Hand":!0,"Left Foot":!1,"Right Foot":!1});break;case"Both Feet":this.showIcon.set({"Left Hand":!1,"Right Hand":!1,"Left Foot":!0,"Right Foot":!0});break;case"Left Hand - Right Foot":this.showIcon.set({"Left Hand":!0,"Right Hand":!1,"Left Foot":!1,"Right Foot":!0});break;case"Right Hand - Left Foot":this.showIcon.set({"Left Hand":!1,"Right Hand":!0,"Left Foot":!0,"Right Foot":!1});break;case"Rest":this.showIcon.set({"Left Hand":!1,"Right Hand":!1,"Left Foot":!1,"Right Foot":!1});break;case null:this.showIcon.set({"Left Hand":!1,"Right Hand":!1,"Left Foot":!1,"Right Foot":!1});break}}setOpacity(t,i){let e=[];switch(t){case"Left Hand":e=["Left Hand"];break;case"Right Hand":e=["Right Hand"];break;case"Both Hands":e=["Left Hand","Right Hand"];break;case"Both Feet":e=["Left Foot","Right Foot"];break;case"Left Hand - Right Foot":e=["Left Hand","Right Foot"];break;case"Right Hand - Left Foot":e=["Right Hand","Left Foot"];break}for(let a of e){let n=this.cuesElement.find(r=>r._elementRef.nativeElement.getAttribute("cue-key")===this.fixClass(a));n&&(n._elementRef.nativeElement.style.opacity=i.toString())}}stopStimuliSequence(){this.showTrial(null)}runStimuliSequence(){let t=this.generateTrials(),i=performance.now(),e=0,a=[],n=()=>{a.forEach(o=>window.clearTimeout(o)),a=[]},r=()=>{if(e>=t.length){n(),this.onDelivery.set(!1);return}let o=t[e],$=i+t.slice(0,e).reduce((c,g)=>c+g.duration+g.soa,0),Y=Math.max(0,$-performance.now()),q=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial Start: ${o.class}" GREEN;`),this.showTrial(o.class);let c=window.setTimeout(()=>{this.hardwareService.writeLine(`CMD=@LOG "Trial End: ${o.class}" ORANGE;`),this.showTrial(null),e++,this.setProgress(100*e/t.length),r()},o.duration);a.push(c)},Y);a.push(q)};return r(),n}static \u0275fac=(()=>{let t;return function(e){return(t||(t=v(s)))(e||s)}})();static \u0275cmp=w({type:s,selectors:[["app-stimuli"]],features:[R],decls:4,vars:1,consts:[["cueElement",""],[3,"hostRef"],["cols","2","rowHeight","50%",1,"center"],[1,"cue","conditional-visible"]],template:function(i,e){i&1&&(m(0,"app-stimuli-layout",1)(1,"mat-grid-list",2),F(2,U,4,6,"mat-grid-tile",null,y),f()()),i&2&&(C("hostRef",e),l(2),T(e.cues))},dependencies:[O,x,D,B,P,E,_,G],styles:[".cue[_ngcontent-%COMP%]{color:var(--mat-sys-primary);width:1em;height:1em;font-size:20vh}mat-grid-list[_ngcontent-%COMP%]{width:70vh;height:70vh}.conditional-visible[_ngcontent-%COMP%]{visibility:visible;opacity:.2;transform:scale(1);transition:opacity .3s ease,visibility .3s ease,transform .3s ease}.conditional-visible.mirror[_ngcontent-%COMP%]{transform:scale(1) rotateY(180deg)}.conditional-visible.visible[_ngcontent-%COMP%]{visibility:visible;opacity:1;transform:scale(1.2)}.conditional-visible.visible.mirror[_ngcontent-%COMP%]{transform:scale(1.2) rotateY(180deg)}"]})};d([h("TRIAL",{arguments:["CLASS"],example:"Trial 'Left Hand - Right Foot'",description:"Displays the visual icons corresponding to the specified class or combination of classes. This command is used to cue the participant by activating one or more target regions simultaneously (e.g., hands or feet)."})],s.prototype,"showTrial",1),d([h("OPACITY",{arguments:["CLASS","VALUE"],example:"OPACITY 'Trial Left Hand - Right Foot' 0.5",description:"Sets the visual opacity of the specified class element. The value should range between 0.0 (fully transparent) and 1.0 (fully opaque)."})],s.prototype,"setOpacity",1);var N=s;export{N as a};
